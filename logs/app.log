2025-12-11 00:01:16.127 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m18s191ms).
2025-12-11 00:02:37.583 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=51s391ms).
2025-12-11 00:06:30.384 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m52s801ms).
2025-12-11 00:22:31.052 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m30s665ms).
2025-12-11 01:30:45.833 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=6m13s889ms).
2025-12-11 01:46:40.963 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m55s131ms).
2025-12-11 02:04:11.843 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m849ms).
2025-12-11 02:21:18.694 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m6s851ms).
2025-12-11 02:38:03.732 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m44s999ms).
2025-12-11 02:54:44.134 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m40s402ms).
2025-12-11 03:01:03.518 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m49s362ms).
2025-12-11 03:06:34.724 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m1s193ms).
2025-12-11 03:24:11.981 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m7s245ms).
2025-12-11 03:33:08.780 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=8m56s798ms).
2025-12-11 03:49:08.677 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m29s884ms).
2025-12-11 03:58:13.347 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=9m4s670ms).
2025-12-11 04:03:44.431 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m1s75ms).
2025-12-11 04:20:50.318 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m35s878ms).
2025-12-11 05:38:44.062 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m22s929ms).
2025-12-11 05:55:00.945 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m16s884ms).
2025-12-11 05:58:47.192 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m16s250ms).
2025-12-11 06:03:50.036 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=5m2s845ms).
2025-12-11 06:20:08.559 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m48s513ms).
2025-12-11 06:30:22.039 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=9m43s468ms).
2025-12-11 06:40:53.316 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=10m1s267ms).
2025-12-11 06:57:02.141 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m8s826ms).
2025-12-11 07:02:28.130 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=4m55s996ms).
2025-12-11 07:20:01.878 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=17m3s736ms).
2025-12-11 07:28:41.878 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=8m9s985ms).
2025-12-11 08:30:28.530 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=45s745ms).
2025-12-11 08:41:38.782 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=11m10s258ms).
2025-12-11 12:26:29.491 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=15m49s21ms).
2025-12-11 12:30:27.127 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m27s613ms).
2025-12-11 12:47:15.534 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=16m18s395ms).
2025-12-11 13:43:14.362 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 63320 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 13:43:14.363 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 13:43:14.739 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 13:43:14.760 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 4 JPA repository interfaces.
2025-12-11 13:43:15.099 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 13:43:15.104 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 13:43:15.104 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 13:43:15.121 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 13:43:15.122 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 744 ms
2025-12-11 13:43:15.287 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 13:43:15.316 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 13:43:15.335 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 13:43:15.413 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 13:43:15.422 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 13:43:15.478 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@53d15034
2025-12-11 13:43:15.479 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 13:43:15.519 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 13:43:15.578 ERROR o.s.o.j.LocalContainerEntityManagerFactoryBean - Failed to initialize JPA EntityManagerFactory: Property 'com.xiaoxj.sqlworkflow.domain.WorkflowInstance.state' is annotated '@Enumerated' but its type 'int' is not an enum
2025-12-11 13:43:15.578 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Property 'com.xiaoxj.sqlworkflow.domain.WorkflowInstance.state' is annotated '@Enumerated' but its type 'int' is not an enum
2025-12-11 13:43:15.579 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-12-11 13:43:15.584 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-12-11 13:43:15.585 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-12-11 13:43:15.593 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-12-11 13:43:15.600 ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'entityManagerFactory' defined in class path resource [org/springframework/boot/autoconfigure/orm/jpa/HibernateJpaConfiguration.class]: Property 'com.xiaoxj.sqlworkflow.domain.WorkflowInstance.state' is annotated '@Enumerated' but its type 'int' is not an enum
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1786)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:600)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.context.support.AbstractApplicationContext.getBean(AbstractApplicationContext.java:1234)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:952)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.xiaoxj.sqlworkflow.SqlWorkflowApplication.main(SqlWorkflowApplication.java:11)
Caused by: org.hibernate.AnnotationException: Property 'com.xiaoxj.sqlworkflow.domain.WorkflowInstance.state' is annotated '@Enumerated' but its type 'int' is not an enum
	at org.hibernate.boot.model.internal.BasicValueBinder.prepareBasicAttribute(BasicValueBinder.java:807)
	at org.hibernate.boot.model.internal.BasicValueBinder.setType(BasicValueBinder.java:376)
	at org.hibernate.boot.model.internal.PropertyBinder.makePropertyAndValue(PropertyBinder.java:261)
	at org.hibernate.boot.model.internal.PropertyBinder.makePropertyValueAndBind(PropertyBinder.java:297)
	at org.hibernate.boot.model.internal.PropertyBinder.createBasicBinder(PropertyBinder.java:1169)
	at org.hibernate.boot.model.internal.PropertyBinder.bindBasic(PropertyBinder.java:1071)
	at org.hibernate.boot.model.internal.PropertyBinder.bindProperty(PropertyBinder.java:890)
	at org.hibernate.boot.model.internal.PropertyBinder.buildProperty(PropertyBinder.java:788)
	at org.hibernate.boot.model.internal.PropertyBinder.processElementAnnotations(PropertyBinder.java:709)
	at org.hibernate.boot.model.internal.EntityBinder.processIdPropertiesIfNotAlready(EntityBinder.java:1041)
	at org.hibernate.boot.model.internal.EntityBinder.handleIdentifier(EntityBinder.java:357)
	at org.hibernate.boot.model.internal.EntityBinder.bindEntityClass(EntityBinder.java:237)
	at org.hibernate.boot.model.internal.AnnotationBinder.bindClass(AnnotationBinder.java:423)
	at org.hibernate.boot.model.source.internal.annotations.AnnotationMetadataSourceProcessorImpl.processEntityHierarchies(AnnotationMetadataSourceProcessorImpl.java:256)
	at org.hibernate.boot.model.process.spi.MetadataBuildingProcess$1.processEntityHierarchies(MetadataBuildingProcess.java:279)
	at org.hibernate.boot.model.process.spi.MetadataBuildingProcess.complete(MetadataBuildingProcess.java:322)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.metadata(EntityManagerFactoryBuilderImpl.java:1432)
	at org.hibernate.jpa.boot.internal.EntityManagerFactoryBuilderImpl.build(EntityManagerFactoryBuilderImpl.java:1503)
	at org.springframework.orm.jpa.vendor.SpringHibernateJpaPersistenceProvider.createContainerEntityManagerFactory(SpringHibernateJpaPersistenceProvider.java:75)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.createNativeEntityManagerFactory(LocalContainerEntityManagerFactoryBean.java:390)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.buildNativeEntityManagerFactory(AbstractEntityManagerFactoryBean.java:409)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.afterPropertiesSet(AbstractEntityManagerFactoryBean.java:396)
	at org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean.afterPropertiesSet(LocalContainerEntityManagerFactoryBean.java:366)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableBeanFactory.java:1833)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBeanFactory.java:1782)
	... 16 common frames omitted
2025-12-11 13:44:07.875 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 63424 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 13:44:07.876 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 13:44:08.190 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 13:44:08.210 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 4 JPA repository interfaces.
2025-12-11 13:44:08.522 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 13:44:08.526 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 13:44:08.526 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 13:44:08.546 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 13:44:08.546 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 658 ms
2025-12-11 13:44:08.696 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 13:44:08.723 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 13:44:08.735 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 13:44:08.813 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 13:44:08.821 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 13:44:08.873 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@7ade62a6
2025-12-11 13:44:08.873 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 13:44:08.898 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 13:44:09.209 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 13:44:09.315 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 13:44:09.688 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-11 13:44:10.215 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-12-11 13:44:10.246 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.context.ApplicationContextException: Failed to start bean 'webServerStartStop'
2025-12-11 13:44:10.247 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 13:44:10.248 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-12-11 13:44:10.251 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-12-11 13:44:10.258 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-12-11 13:44:10.262 ERROR o.s.b.d.LoggingFailureAnalysisReporter - 

***************************
APPLICATION FAILED TO START
***************************

Description:

Web server failed to start. Port 9000 was already in use.

Action:

Identify and stop the process that's listening on port 9000 or configure this application to listen on another port.

2025-12-11 13:44:25.567 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 63454 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 13:44:25.568 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 13:44:25.888 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 13:44:25.911 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 4 JPA repository interfaces.
2025-12-11 13:44:26.232 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 13:44:26.236 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 13:44:26.236 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 13:44:26.260 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 13:44:26.260 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 678 ms
2025-12-11 13:44:26.397 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 13:44:26.414 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 13:44:26.424 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 13:44:26.495 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 13:44:26.504 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 13:44:26.556 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@53d15034
2025-12-11 13:44:26.556 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 13:44:26.577 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 13:44:26.882 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 13:44:26.910 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 13:44:27.251 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-11 13:44:27.777 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-12-11 13:44:27.811 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 9000 (http) with context path ''
2025-12-11 13:44:27.818 INFO  c.x.s.SqlWorkflowApplication - Started SqlWorkflowApplication in 2.416 seconds (process running for 2.675)
2025-12-11 13:44:28.290 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-12-11 13:44:28.291 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-12-11 13:44:28.291 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 0 ms
2025-12-11 13:51:53.371 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 64075 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 13:51:53.372 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 13:51:53.713 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 13:51:53.731 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 4 JPA repository interfaces.
2025-12-11 13:51:54.047 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 13:51:54.051 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 13:51:54.051 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 13:51:54.068 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 13:51:54.068 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 683 ms
2025-12-11 13:51:54.206 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 13:51:54.229 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 13:51:54.244 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 13:51:54.320 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 13:51:54.330 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 13:51:54.406 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@176054b7
2025-12-11 13:51:54.406 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 13:51:54.426 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 13:51:54.736 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 13:51:54.766 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 13:51:55.129 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-11 13:51:55.752 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-12-11 13:51:55.790 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 9000 (http) with context path ''
2025-12-11 13:51:55.797 INFO  c.x.s.SqlWorkflowApplication - Started SqlWorkflowApplication in 2.587 seconds (process running for 5.326)
2025-12-11 13:51:56.271 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-12-11 13:51:56.272 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-12-11 13:51:56.273 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-12-11 13:52:56.604 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
java.lang.NullPointerException: Cannot invoke "String.lastIndexOf(String)" because "filePath" is null
	at com.xiaoxj.sqlworkflow.controller.DependencyController.addTask(DependencyController.java:42)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-12-11 13:59:02.788 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
java.lang.NullPointerException: Cannot invoke "com.xiaoxj.sqlworkflow.domain.WorkflowDeploy.getWorkflowCode()" because "workflowDeploy" is null
	at com.xiaoxj.sqlworkflow.controller.DependencyController.updateTask(DependencyController.java:83)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
2025-12-11 13:59:47.955 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/1231231231/workflow-definition, param:{"name":"test","locations":[{"taskCode":159746445284960,"x":100,"y":100}],"taskDefinitionJson":[{"code":159746445284960,"version":0,"name":"SHELL1765432787950","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- #########################################################\n-- 输出表：cdm.dwd_gzg_log_tougu_live_video_di\n-- 输入表：ods.ods_tougu_live_video_hb_di_0log,cdm.dim_gzg_icr_advisor_live_config,pdw.dim_sscf_user\n-- 对应实时表 cdm.dwd_gzg_log_tougu_live_video_mm\n-- #########################################################\n-- 修改时间 2022-09-27 10:03\n\nset hive.auto.convert.join = false;\n\ninsert overwrite table cdm.dwd_gzg_log_tougu_live_video_di PARTITION (dt)\nselect case\n           when p3.user_id is not null then p1.visitor_id --app客户端ios端存在1/6的账号异常，长用户id获取不到\n           when p1.terminal in (2, 3, 4, 5) then p1.visitor_id --手机端h5、大网站、pc客户端不存在游客账号体系、微信小程序数据\n           when p1.terminal = 1 and p1.account_id rlike '^AL' then p1.visitor_id\n    end                                                                      as user_id\n     , coalesce(p1.account_id, p3.account_id)                                as account_id\n     , p1.visitor_id\n     , p1.user_number\n     , p1.terminal\n     , p1.platform\n     , p1.device_id\n     , p1.live_id\n     , p2.start_time\n     , p2.end_time\n     , p1.circle_id\n     , from_unixtime(cast(p1.begin_time as bigint), 'yyyy-MM-dd HH:mm:ss')   as begin_time\n     , from_unixtime(cast(p1.monitor_time as bigint), 'yyyy-MM-dd HH:mm:ss') as monitor_time\n     , p1.sip\n     , p1.unionid\n     , coalesce(p1.video_type, 1)                                            as video_type\n     , p1.staff_id\n     , p1.head_url\n     , p1.wechat_nick\n     , dt\nfrom (select case when user_number rlike '^(GZ|AZ)([A-Z0-9])+$' then default.get_userId(user_number) end as visitor_id\n           , case when terminal = '' then null else terminal end                                         as terminal\n           , case when platform = '' then null else platform end                                         as platform\n           , case when device_id = '' then null else device_id end                                       as device_id\n           , case when user_number = '' then null else user_number end                                   as user_number\n           , case when account_id = '' then null else account_id end                                     as account_id\n           , case when live_id = '' then null else live_id end                                           as live_id\n           , case when circle_id = '' then null else circle_id end                                       as circle_id\n           , case when begin_time = '' then null else begin_time end                                     as begin_time\n           , case when monitor_time = '' then null else monitor_time end                                 as monitor_time\n           , case when unionid = '' then null else unionid end                                           as unionid\n           , case when video_type = '' then null else video_type end                                     as video_type\n           , case when sip = '' then null else sip end                                                   as sip\n           , case when staff_id = '' then null else staff_id end                                         as staff_id\n           , case when head_url = '' then null else head_url end                                         as head_url\n           , case when wechat_nick = '' then null else wechat_nick end                                   as wechat_nick\n           , dt\n      from (select split(log_str, '\\\\|')[0]  as terminal\n                 , split(log_str, '\\\\|')[1]  as platform\n                 , split(log_str, '\\\\|')[2]  as device_id\n                 , split(log_str, '\\\\|')[3]  as user_number\n                 , split(log_str, '\\\\|')[4]  as account_id\n                 , split(log_str, '\\\\|')[5]  as live_id\n                 , split(log_str, '\\\\|')[6]  as circle_id\n                 , split(log_str, '\\\\|')[7]  as begin_time\n                 , split(log_str, '\\\\|')[8]  as monitor_time\n                 , split(log_str, '\\\\|')[9]  as unionid\n                 , split(log_str, '\\\\|')[10] as video_type\n                 , split(log_str, '\\\\|')[11] as staff_id\n                 , split(log_str, '\\\\|')[12] as head_url\n                 , split(log_str, '\\\\|')[13] as wechat_nick\n                 , sip\n                 , dt\n            from ods.ods_tougu_live_video_hb_di_0log\n            where dt = date_sub('2025-01-01', 1)\n              and log_str not rlike 'unionid='\n            union all\n            select log_map['terminal']    as terminal\n                 , log_map['platform']    as platform\n                 , log_map['deviceId']    as device_id\n                 , log_map['userNum']     as user_number\n                 , log_map['accountId']   as account_id\n                 , log_map['liveId']      as live_id\n                 , log_map['circlId']     as circle_id\n                 , log_map['beginTime']   as begin_time\n                 , log_map['monitorTime'] as monitor_time\n                 , log_map['unionid']     as unionid\n                 , coalesce(log_map['videoType'], log_map['video_type'])    as video_type\n                 , coalesce(log_map['staff_id'], log_map['salesperson_id'],log_map['scrmUserId']) as staff_id\n                 , log_map['head']                                          as head_url\n                 , coalesce(log_map['nickname'], log_map['nick_name'])      as wechat_nick\n                 , sip\n                 , dt\n            from (\n                     select STR_TO_MAP(log_str, '\\\\|', '=') as log_map\n                          , sip\n                          , dt\n                     from ods.ods_tougu_live_video_hb_di_0log\n                     where dt = date_sub('2025-01-01', 1)\n                       and log_str rlike 'unionid='\n                 ) p1\n           ) a\n     ) p1\n         left join\n     (select id\n           , case when start_time = '' then null else start_time end as start_time\n           , case when end_time = '' then null else end_time end     as end_time\n      from cdm.dim_gzg_icr_advisor_live_config\n      where live_day = date_sub('2025-01-01', 1)\n        and live_type = 1\n     ) p2\n     on p1.live_id = p2.id\n         left join\n     (select user_number\n           , user_id\n           , account_id\n      from cdm.dim_gzg_usr_user_info\n      where account_type = 1\n     ) p3\n     on p1.user_number = p3.user_number;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159746445284960,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"1231231231","description":"输出表：cdm.dwd_gzg_log_tougu_live_video_di\n输入表：ods.ods_tougu_live_video_hb_di_0log,cdm.dim_gzg_icr_advisor_live_config,pdw.dim_sscf_user\n对应实时表 cdm.dwd_gzg_log_tougu_live_video_mm\n\n修改时间 2022-09-27 10:03","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 13:59:47.997 ERROR c.x.s.d.workflow.WorkflowOperator - dolphin scheduler response:HttpRestResult(code=10018, msg=project  not found , data=null, success=false, failed=true)
2025-12-11 13:59:47.997 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
com.xiaoxj.sqlworkflow.core.DolphinException: create dolphin scheduler workflow fail
	at com.xiaoxj.sqlworkflow.dolphinscheduler.workflow.WorkflowOperator.create(WorkflowOperator.java:85)
	at com.xiaoxj.sqlworkflow.service.DolphinSchedulerService.createWorkflow(DolphinSchedulerService.java:71)
	at com.xiaoxj.sqlworkflow.controller.DependencyController.addTask(DependencyController.java:53)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: com.xiaoxj.sqlworkflow.core.DolphinException: create dolphin scheduler workflow fail
	at com.xiaoxj.sqlworkflow.dolphinscheduler.workflow.WorkflowOperator.create(WorkflowOperator.java:82)
	... 54 common frames omitted
2025-12-11 14:00:22.871 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 75847 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 14:00:22.871 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 14:00:23.232 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 14:00:23.249 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 15 ms. Found 4 JPA repository interfaces.
2025-12-11 14:00:23.568 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 14:00:23.573 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 14:00:23.573 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 14:00:23.590 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 14:00:23.590 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 704 ms
2025-12-11 14:00:23.729 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 14:00:23.752 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 14:00:23.764 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 14:00:23.848 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 14:00:23.858 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 14:00:23.917 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@54087bdb
2025-12-11 14:00:23.918 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 14:00:23.951 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 14:00:24.254 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 14:00:24.288 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:00:24.649 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-11 14:00:25.188 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-12-11 14:00:25.227 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 9000 (http) with context path ''
2025-12-11 14:00:25.236 INFO  c.x.s.SqlWorkflowApplication - Started SqlWorkflowApplication in 2.568 seconds (process running for 3.125)
2025-12-11 14:00:25.780 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-12-11 14:00:25.780 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-12-11 14:00:25.781 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-12-11 14:00:33.489 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/1231231231/workflow-definition, param:{"name":"test","locations":[{"taskCode":159746491912800,"x":100,"y":100}],"taskDefinitionJson":[{"code":159746491912800,"version":0,"name":"SHELL1765432833483","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- #########################################################\n-- 输出表：cdm.dwd_gzg_log_tougu_live_video_di\n-- 输入表：ods.ods_tougu_live_video_hb_di_0log,cdm.dim_gzg_icr_advisor_live_config,pdw.dim_sscf_user\n-- 对应实时表 cdm.dwd_gzg_log_tougu_live_video_mm\n-- #########################################################\n-- 修改时间 2022-09-27 10:03\n\nset hive.auto.convert.join = false;\n\ninsert overwrite table cdm.dwd_gzg_log_tougu_live_video_di PARTITION (dt)\nselect case\n           when p3.user_id is not null then p1.visitor_id --app客户端ios端存在1/6的账号异常，长用户id获取不到\n           when p1.terminal in (2, 3, 4, 5) then p1.visitor_id --手机端h5、大网站、pc客户端不存在游客账号体系、微信小程序数据\n           when p1.terminal = 1 and p1.account_id rlike '^AL' then p1.visitor_id\n    end                                                                      as user_id\n     , coalesce(p1.account_id, p3.account_id)                                as account_id\n     , p1.visitor_id\n     , p1.user_number\n     , p1.terminal\n     , p1.platform\n     , p1.device_id\n     , p1.live_id\n     , p2.start_time\n     , p2.end_time\n     , p1.circle_id\n     , from_unixtime(cast(p1.begin_time as bigint), 'yyyy-MM-dd HH:mm:ss')   as begin_time\n     , from_unixtime(cast(p1.monitor_time as bigint), 'yyyy-MM-dd HH:mm:ss') as monitor_time\n     , p1.sip\n     , p1.unionid\n     , coalesce(p1.video_type, 1)                                            as video_type\n     , p1.staff_id\n     , p1.head_url\n     , p1.wechat_nick\n     , dt\nfrom (select case when user_number rlike '^(GZ|AZ)([A-Z0-9])+$' then default.get_userId(user_number) end as visitor_id\n           , case when terminal = '' then null else terminal end                                         as terminal\n           , case when platform = '' then null else platform end                                         as platform\n           , case when device_id = '' then null else device_id end                                       as device_id\n           , case when user_number = '' then null else user_number end                                   as user_number\n           , case when account_id = '' then null else account_id end                                     as account_id\n           , case when live_id = '' then null else live_id end                                           as live_id\n           , case when circle_id = '' then null else circle_id end                                       as circle_id\n           , case when begin_time = '' then null else begin_time end                                     as begin_time\n           , case when monitor_time = '' then null else monitor_time end                                 as monitor_time\n           , case when unionid = '' then null else unionid end                                           as unionid\n           , case when video_type = '' then null else video_type end                                     as video_type\n           , case when sip = '' then null else sip end                                                   as sip\n           , case when staff_id = '' then null else staff_id end                                         as staff_id\n           , case when head_url = '' then null else head_url end                                         as head_url\n           , case when wechat_nick = '' then null else wechat_nick end                                   as wechat_nick\n           , dt\n      from (select split(log_str, '\\\\|')[0]  as terminal\n                 , split(log_str, '\\\\|')[1]  as platform\n                 , split(log_str, '\\\\|')[2]  as device_id\n                 , split(log_str, '\\\\|')[3]  as user_number\n                 , split(log_str, '\\\\|')[4]  as account_id\n                 , split(log_str, '\\\\|')[5]  as live_id\n                 , split(log_str, '\\\\|')[6]  as circle_id\n                 , split(log_str, '\\\\|')[7]  as begin_time\n                 , split(log_str, '\\\\|')[8]  as monitor_time\n                 , split(log_str, '\\\\|')[9]  as unionid\n                 , split(log_str, '\\\\|')[10] as video_type\n                 , split(log_str, '\\\\|')[11] as staff_id\n                 , split(log_str, '\\\\|')[12] as head_url\n                 , split(log_str, '\\\\|')[13] as wechat_nick\n                 , sip\n                 , dt\n            from ods.ods_tougu_live_video_hb_di_0log\n            where dt = date_sub('2025-01-01', 1)\n              and log_str not rlike 'unionid='\n            union all\n            select log_map['terminal']    as terminal\n                 , log_map['platform']    as platform\n                 , log_map['deviceId']    as device_id\n                 , log_map['userNum']     as user_number\n                 , log_map['accountId']   as account_id\n                 , log_map['liveId']      as live_id\n                 , log_map['circlId']     as circle_id\n                 , log_map['beginTime']   as begin_time\n                 , log_map['monitorTime'] as monitor_time\n                 , log_map['unionid']     as unionid\n                 , coalesce(log_map['videoType'], log_map['video_type'])    as video_type\n                 , coalesce(log_map['staff_id'], log_map['salesperson_id'],log_map['scrmUserId']) as staff_id\n                 , log_map['head']                                          as head_url\n                 , coalesce(log_map['nickname'], log_map['nick_name'])      as wechat_nick\n                 , sip\n                 , dt\n            from (\n                     select STR_TO_MAP(log_str, '\\\\|', '=') as log_map\n                          , sip\n                          , dt\n                     from ods.ods_tougu_live_video_hb_di_0log\n                     where dt = date_sub('2025-01-01', 1)\n                       and log_str rlike 'unionid='\n                 ) p1\n           ) a\n     ) p1\n         left join\n     (select id\n           , case when start_time = '' then null else start_time end as start_time\n           , case when end_time = '' then null else end_time end     as end_time\n      from cdm.dim_gzg_icr_advisor_live_config\n      where live_day = date_sub('2025-01-01', 1)\n        and live_type = 1\n     ) p2\n     on p1.live_id = p2.id\n         left join\n     (select user_number\n           , user_id\n           , account_id\n      from cdm.dim_gzg_usr_user_info\n      where account_type = 1\n     ) p3\n     on p1.user_number = p3.user_number;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159746491912800,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"1231231231","description":"输出表：cdm.dwd_gzg_log_tougu_live_video_di\n输入表：ods.ods_tougu_live_video_hb_di_0log,cdm.dim_gzg_icr_advisor_live_config,pdw.dim_sscf_user\n对应实时表 cdm.dwd_gzg_log_tougu_live_video_mm\n\n修改时间 2022-09-27 10:03","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:00:33.518 ERROR c.x.s.d.workflow.WorkflowOperator - dolphin scheduler response:HttpRestResult(code=10018, msg=project  not found , data=null, success=false, failed=true)
2025-12-11 14:00:33.518 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
com.xiaoxj.sqlworkflow.core.DolphinException: create dolphin scheduler workflow fail
	at com.xiaoxj.sqlworkflow.dolphinscheduler.workflow.WorkflowOperator.create(WorkflowOperator.java:85)
	at com.xiaoxj.sqlworkflow.service.DolphinSchedulerService.createWorkflow(DolphinSchedulerService.java:71)
	at com.xiaoxj.sqlworkflow.controller.DependencyController.addTask(DependencyController.java:53)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: com.xiaoxj.sqlworkflow.core.DolphinException: create dolphin scheduler workflow fail
	at com.xiaoxj.sqlworkflow.dolphinscheduler.workflow.WorkflowOperator.create(WorkflowOperator.java:82)
	... 54 common frames omitted
2025-12-11 14:02:02.226 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 76013 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 14:02:02.227 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 14:02:02.602 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 14:02:02.626 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 4 JPA repository interfaces.
2025-12-11 14:02:03.040 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 14:02:03.044 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 14:02:03.045 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 14:02:03.067 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 14:02:03.067 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 823 ms
2025-12-11 14:02:03.281 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 14:02:03.319 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 14:02:03.333 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 14:02:03.438 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 14:02:03.449 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 14:02:03.529 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@53d15034
2025-12-11 14:02:03.530 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 14:02:03.564 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 14:02:03.925 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 14:02:03.963 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:02:04.251 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dependencyController': Unsatisfied dependency expressed through field 'dolphinSchedulerService': Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
2025-12-11 14:02:04.251 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:02:04.252 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-12-11 14:02:04.255 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-12-11 14:02:04.255 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-12-11 14:02:04.262 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-12-11 14:02:04.267 ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dependencyController': Unsatisfied dependency expressed through field 'dolphinSchedulerService': Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:787)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.xiaoxj.sqlworkflow.SqlWorkflowApplication.main(SqlWorkflowApplication.java:11)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:787)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	... 20 common frames omitted
Caused by: org.springframework.beans.factory.BeanExpressionException: Expression parsing failed
	at org.springframework.context.expression.StandardBeanExpressionResolver.evaluate(StandardBeanExpressionResolver.java:186)
	at org.springframework.beans.factory.support.AbstractBeanFactory.evaluateBeanDefinitionString(AbstractBeanFactory.java:1606)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1377)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	... 34 common frames omitted
Caused by: org.springframework.expression.spel.SpelParseException: EL1035E: The value '159198460609120' cannot be parsed as an int
	at org.springframework.expression.spel.ast.Literal.getIntLiteral(Literal.java:96)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.maybeEatLiteral(InternalSpelExpressionParser.java:857)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatStartNode(InternalSpelExpressionParser.java:522)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatPrimaryExpression(InternalSpelExpressionParser.java:369)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatUnaryExpression(InternalSpelExpressionParser.java:363)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatPowerIncDecExpression(InternalSpelExpressionParser.java:317)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatProductExpression(InternalSpelExpressionParser.java:296)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatSumExpression(InternalSpelExpressionParser.java:278)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatRelationalExpression(InternalSpelExpressionParser.java:233)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatLogicalAndExpression(InternalSpelExpressionParser.java:220)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatLogicalOrExpression(InternalSpelExpressionParser.java:207)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatExpression(InternalSpelExpressionParser.java:168)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.doParseExpression(InternalSpelExpressionParser.java:138)
	at org.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:63)
	at org.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:34)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseExpressions(TemplateAwareExpressionParser.java:125)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseTemplate(TemplateAwareExpressionParser.java:66)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseExpression(TemplateAwareExpressionParser.java:52)
	at org.springframework.context.expression.StandardBeanExpressionResolver.evaluate(StandardBeanExpressionResolver.java:164)
	... 38 common frames omitted
Caused by: java.lang.NumberFormatException: For input string: "159198460609120"
	at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)
	at java.base/java.lang.Integer.parseInt(Integer.java:662)
	at org.springframework.expression.spel.ast.Literal.getIntLiteral(Literal.java:92)
	... 56 common frames omitted
2025-12-11 14:02:42.080 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 76083 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 14:02:42.080 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 14:02:42.411 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 14:02:42.431 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 17 ms. Found 4 JPA repository interfaces.
2025-12-11 14:02:42.746 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 14:02:42.750 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 14:02:42.750 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 14:02:42.768 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 14:02:42.768 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 672 ms
2025-12-11 14:02:42.909 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 14:02:42.929 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 14:02:42.939 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 14:02:43.014 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 14:02:43.025 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 14:02:43.078 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@41d84abb
2025-12-11 14:02:43.079 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 14:02:43.098 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 14:02:43.410 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 14:02:43.438 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:02:43.729 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dependencyController': Unsatisfied dependency expressed through field 'dolphinSchedulerService': Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
2025-12-11 14:02:43.730 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:02:43.730 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-12-11 14:02:43.733 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-12-11 14:02:43.734 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-12-11 14:02:43.740 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-12-11 14:02:43.747 ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dependencyController': Unsatisfied dependency expressed through field 'dolphinSchedulerService': Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:787)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.xiaoxj.sqlworkflow.SqlWorkflowApplication.main(SqlWorkflowApplication.java:11)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:787)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	... 20 common frames omitted
Caused by: org.springframework.beans.factory.BeanExpressionException: Expression parsing failed
	at org.springframework.context.expression.StandardBeanExpressionResolver.evaluate(StandardBeanExpressionResolver.java:186)
	at org.springframework.beans.factory.support.AbstractBeanFactory.evaluateBeanDefinitionString(AbstractBeanFactory.java:1606)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1377)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	... 34 common frames omitted
Caused by: org.springframework.expression.spel.SpelParseException: EL1035E: The value '159198460609120' cannot be parsed as an int
	at org.springframework.expression.spel.ast.Literal.getIntLiteral(Literal.java:96)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.maybeEatLiteral(InternalSpelExpressionParser.java:857)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatStartNode(InternalSpelExpressionParser.java:522)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatPrimaryExpression(InternalSpelExpressionParser.java:369)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatUnaryExpression(InternalSpelExpressionParser.java:363)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatPowerIncDecExpression(InternalSpelExpressionParser.java:317)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatProductExpression(InternalSpelExpressionParser.java:296)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatSumExpression(InternalSpelExpressionParser.java:278)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatRelationalExpression(InternalSpelExpressionParser.java:233)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatLogicalAndExpression(InternalSpelExpressionParser.java:220)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatLogicalOrExpression(InternalSpelExpressionParser.java:207)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatExpression(InternalSpelExpressionParser.java:168)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.doParseExpression(InternalSpelExpressionParser.java:138)
	at org.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:63)
	at org.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:34)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseExpressions(TemplateAwareExpressionParser.java:125)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseTemplate(TemplateAwareExpressionParser.java:66)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseExpression(TemplateAwareExpressionParser.java:52)
	at org.springframework.context.expression.StandardBeanExpressionResolver.evaluate(StandardBeanExpressionResolver.java:164)
	... 38 common frames omitted
Caused by: java.lang.NumberFormatException: For input string: "159198460609120"
	at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)
	at java.base/java.lang.Integer.parseInt(Integer.java:662)
	at org.springframework.expression.spel.ast.Literal.getIntLiteral(Literal.java:92)
	... 56 common frames omitted
2025-12-11 14:06:18.286 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 76336 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 14:06:18.286 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 14:06:18.633 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 14:06:18.652 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 16 ms. Found 4 JPA repository interfaces.
2025-12-11 14:06:18.995 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 14:06:19.001 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 14:06:19.001 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 14:06:19.030 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 14:06:19.031 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 732 ms
2025-12-11 14:06:19.170 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 14:06:19.195 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 14:06:19.207 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 14:06:19.287 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 14:06:19.297 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 14:06:19.392 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@240df292
2025-12-11 14:06:19.392 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 14:06:19.432 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 14:06:19.735 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 14:06:19.779 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:06:20.062 WARN  o.s.b.w.s.c.AnnotationConfigServletWebServerApplicationContext - Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dependencyController': Unsatisfied dependency expressed through field 'dolphinSchedulerService': Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
2025-12-11 14:06:20.063 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:06:20.063 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-12-11 14:06:20.066 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-12-11 14:06:20.067 INFO  o.a.catalina.core.StandardService - Stopping service [Tomcat]
2025-12-11 14:06:20.073 INFO  o.s.b.a.l.ConditionEvaluationReportLogger - 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-12-11 14:06:20.078 ERROR o.s.boot.SpringApplication - Application run failed
org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dependencyController': Unsatisfied dependency expressed through field 'dolphinSchedulerService': Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:787)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:975)
	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:962)
	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:624)
	at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:146)
	at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:754)
	at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:456)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:334)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1354)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1343)
	at com.xiaoxj.sqlworkflow.SqlWorkflowApplication.main(SqlWorkflowApplication.java:11)
Caused by: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'dolphinSchedulerService': Unsatisfied dependency expressed through field 'projectCode': Expression parsing failed
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:787)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.inject(AutowiredAnnotationBeanPostProcessor.java:767)
	at org.springframework.beans.factory.annotation.InjectionMetadata.inject(InjectionMetadata.java:145)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.postProcessProperties(AutowiredAnnotationBeanPostProcessor.java:508)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean(AbstractAutowireCapableBeanFactory.java:1419)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:599)
	at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:522)
	at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:326)
	at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:234)
	at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:324)
	at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:200)
	at org.springframework.beans.factory.config.DependencyDescriptor.resolveCandidate(DependencyDescriptor.java:254)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1443)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	... 20 common frames omitted
Caused by: org.springframework.beans.factory.BeanExpressionException: Expression parsing failed
	at org.springframework.context.expression.StandardBeanExpressionResolver.evaluate(StandardBeanExpressionResolver.java:186)
	at org.springframework.beans.factory.support.AbstractBeanFactory.evaluateBeanDefinitionString(AbstractBeanFactory.java:1606)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.doResolveDependency(DefaultListableBeanFactory.java:1377)
	at org.springframework.beans.factory.support.DefaultListableBeanFactory.resolveDependency(DefaultListableBeanFactory.java:1353)
	at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor$AutowiredFieldElement.resolveFieldValue(AutowiredAnnotationBeanPostProcessor.java:784)
	... 34 common frames omitted
Caused by: org.springframework.expression.spel.SpelParseException: EL1035E: The value '159198460609120' cannot be parsed as an int
	at org.springframework.expression.spel.ast.Literal.getIntLiteral(Literal.java:96)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.maybeEatLiteral(InternalSpelExpressionParser.java:857)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatStartNode(InternalSpelExpressionParser.java:522)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatPrimaryExpression(InternalSpelExpressionParser.java:369)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatUnaryExpression(InternalSpelExpressionParser.java:363)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatPowerIncDecExpression(InternalSpelExpressionParser.java:317)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatProductExpression(InternalSpelExpressionParser.java:296)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatSumExpression(InternalSpelExpressionParser.java:278)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatRelationalExpression(InternalSpelExpressionParser.java:233)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatLogicalAndExpression(InternalSpelExpressionParser.java:220)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatLogicalOrExpression(InternalSpelExpressionParser.java:207)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.eatExpression(InternalSpelExpressionParser.java:168)
	at org.springframework.expression.spel.standard.InternalSpelExpressionParser.doParseExpression(InternalSpelExpressionParser.java:138)
	at org.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:63)
	at org.springframework.expression.spel.standard.SpelExpressionParser.doParseExpression(SpelExpressionParser.java:34)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseExpressions(TemplateAwareExpressionParser.java:125)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseTemplate(TemplateAwareExpressionParser.java:66)
	at org.springframework.expression.common.TemplateAwareExpressionParser.parseExpression(TemplateAwareExpressionParser.java:52)
	at org.springframework.context.expression.StandardBeanExpressionResolver.evaluate(StandardBeanExpressionResolver.java:164)
	... 38 common frames omitted
Caused by: java.lang.NumberFormatException: For input string: "159198460609120"
	at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:67)
	at java.base/java.lang.Integer.parseInt(Integer.java:662)
	at org.springframework.expression.spel.ast.Literal.getIntLiteral(Literal.java:92)
	... 56 common frames omitted
2025-12-11 14:07:47.447 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 76452 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 14:07:47.448 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 14:07:47.802 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 14:07:47.823 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 18 ms. Found 4 JPA repository interfaces.
2025-12-11 14:07:48.145 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 14:07:48.149 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 14:07:48.149 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 14:07:48.167 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 14:07:48.167 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 705 ms
2025-12-11 14:07:48.308 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 14:07:48.333 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 14:07:48.344 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 14:07:48.427 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 14:07:48.437 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 14:07:48.532 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@67b09e34
2025-12-11 14:07:48.533 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 14:07:48.567 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 14:07:48.879 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 14:07:48.923 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:07:49.308 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-11 14:07:49.850 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-12-11 14:07:49.885 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 9000 (http) with context path ''
2025-12-11 14:07:49.892 INFO  c.x.s.SqlWorkflowApplication - Started SqlWorkflowApplication in 2.63 seconds (process running for 3.026)
2025-12-11 14:07:49.953 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-12-11 14:07:49.953 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-12-11 14:07:49.954 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-12-11 14:07:58.714 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"test","locations":[{"taskCode":159746947827296,"x":100,"y":100}],"taskDefinitionJson":[{"code":159746947827296,"version":0,"name":"SHELL1765433278709","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- #########################################################\n-- 输出表：cdm.dwd_gzg_log_tougu_live_video_di\n-- 输入表：ods.ods_tougu_live_video_hb_di_0log,cdm.dim_gzg_icr_advisor_live_config,pdw.dim_sscf_user\n-- 对应实时表 cdm.dwd_gzg_log_tougu_live_video_mm\n-- #########################################################\n-- 修改时间 2022-09-27 10:03\n\nset hive.auto.convert.join = false;\n\ninsert overwrite table cdm.dwd_gzg_log_tougu_live_video_di PARTITION (dt)\nselect case\n           when p3.user_id is not null then p1.visitor_id --app客户端ios端存在1/6的账号异常，长用户id获取不到\n           when p1.terminal in (2, 3, 4, 5) then p1.visitor_id --手机端h5、大网站、pc客户端不存在游客账号体系、微信小程序数据\n           when p1.terminal = 1 and p1.account_id rlike '^AL' then p1.visitor_id\n    end                                                                      as user_id\n     , coalesce(p1.account_id, p3.account_id)                                as account_id\n     , p1.visitor_id\n     , p1.user_number\n     , p1.terminal\n     , p1.platform\n     , p1.device_id\n     , p1.live_id\n     , p2.start_time\n     , p2.end_time\n     , p1.circle_id\n     , from_unixtime(cast(p1.begin_time as bigint), 'yyyy-MM-dd HH:mm:ss')   as begin_time\n     , from_unixtime(cast(p1.monitor_time as bigint), 'yyyy-MM-dd HH:mm:ss') as monitor_time\n     , p1.sip\n     , p1.unionid\n     , coalesce(p1.video_type, 1)                                            as video_type\n     , p1.staff_id\n     , p1.head_url\n     , p1.wechat_nick\n     , dt\nfrom (select case when user_number rlike '^(GZ|AZ)([A-Z0-9])+$' then default.get_userId(user_number) end as visitor_id\n           , case when terminal = '' then null else terminal end                                         as terminal\n           , case when platform = '' then null else platform end                                         as platform\n           , case when device_id = '' then null else device_id end                                       as device_id\n           , case when user_number = '' then null else user_number end                                   as user_number\n           , case when account_id = '' then null else account_id end                                     as account_id\n           , case when live_id = '' then null else live_id end                                           as live_id\n           , case when circle_id = '' then null else circle_id end                                       as circle_id\n           , case when begin_time = '' then null else begin_time end                                     as begin_time\n           , case when monitor_time = '' then null else monitor_time end                                 as monitor_time\n           , case when unionid = '' then null else unionid end                                           as unionid\n           , case when video_type = '' then null else video_type end                                     as video_type\n           , case when sip = '' then null else sip end                                                   as sip\n           , case when staff_id = '' then null else staff_id end                                         as staff_id\n           , case when head_url = '' then null else head_url end                                         as head_url\n           , case when wechat_nick = '' then null else wechat_nick end                                   as wechat_nick\n           , dt\n      from (select split(log_str, '\\\\|')[0]  as terminal\n                 , split(log_str, '\\\\|')[1]  as platform\n                 , split(log_str, '\\\\|')[2]  as device_id\n                 , split(log_str, '\\\\|')[3]  as user_number\n                 , split(log_str, '\\\\|')[4]  as account_id\n                 , split(log_str, '\\\\|')[5]  as live_id\n                 , split(log_str, '\\\\|')[6]  as circle_id\n                 , split(log_str, '\\\\|')[7]  as begin_time\n                 , split(log_str, '\\\\|')[8]  as monitor_time\n                 , split(log_str, '\\\\|')[9]  as unionid\n                 , split(log_str, '\\\\|')[10] as video_type\n                 , split(log_str, '\\\\|')[11] as staff_id\n                 , split(log_str, '\\\\|')[12] as head_url\n                 , split(log_str, '\\\\|')[13] as wechat_nick\n                 , sip\n                 , dt\n            from ods.ods_tougu_live_video_hb_di_0log\n            where dt = date_sub('2025-01-01', 1)\n              and log_str not rlike 'unionid='\n            union all\n            select log_map['terminal']    as terminal\n                 , log_map['platform']    as platform\n                 , log_map['deviceId']    as device_id\n                 , log_map['userNum']     as user_number\n                 , log_map['accountId']   as account_id\n                 , log_map['liveId']      as live_id\n                 , log_map['circlId']     as circle_id\n                 , log_map['beginTime']   as begin_time\n                 , log_map['monitorTime'] as monitor_time\n                 , log_map['unionid']     as unionid\n                 , coalesce(log_map['videoType'], log_map['video_type'])    as video_type\n                 , coalesce(log_map['staff_id'], log_map['salesperson_id'],log_map['scrmUserId']) as staff_id\n                 , log_map['head']                                          as head_url\n                 , coalesce(log_map['nickname'], log_map['nick_name'])      as wechat_nick\n                 , sip\n                 , dt\n            from (\n                     select STR_TO_MAP(log_str, '\\\\|', '=') as log_map\n                          , sip\n                          , dt\n                     from ods.ods_tougu_live_video_hb_di_0log\n                     where dt = date_sub('2025-01-01', 1)\n                       and log_str rlike 'unionid='\n                 ) p1\n           ) a\n     ) p1\n         left join\n     (select id\n           , case when start_time = '' then null else start_time end as start_time\n           , case when end_time = '' then null else end_time end     as end_time\n      from cdm.dim_gzg_icr_advisor_live_config\n      where live_day = date_sub('2025-01-01', 1)\n        and live_type = 1\n     ) p2\n     on p1.live_id = p2.id\n         left join\n     (select user_number\n           , user_id\n           , account_id\n      from cdm.dim_gzg_usr_user_info\n      where account_type = 1\n     ) p3\n     on p1.user_number = p3.user_number;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159746947827296,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"输出表：cdm.dwd_gzg_log_tougu_live_video_di\n输入表：ods.ods_tougu_live_video_hb_di_0log,cdm.dim_gzg_icr_advisor_live_config,pdw.dim_sscf_user\n对应实时表 cdm.dwd_gzg_log_tougu_live_video_mm\n\n修改时间 2022-09-27 10:03","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:07:58.816 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159746947889760/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:15:08.642 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dws_gzg_cin_sign_stat_mi","locations":[{"taskCode":159747388090976,"x":100,"y":100}],"taskDefinitionJson":[{"code":159747388090976,"version":0,"name":"SHELL1765433708641","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- 修改时间 2022年8月30日15:52:35\ninsert overwrite table cdm.dws_gzg_cin_sign_stat_mi partition (mt)\nselect user_id,\n       count(distinct dt)                      as sign_cnt,\n       date_format(date_sub('2025-01-01', 1), 'yyyy-MM') as mt\nfrom cdm.dwd_gzg_cin_sign_info_di\nwhere dt >= trunc(date_sub('2025-01-01', 1), 'MM')\n  and dt <= date_sub('2025-01-01', 1)\ngroup by user_id;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159747388090976,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"修改时间 2022年8月30日15:52:35","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:15:08.701 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159747388120672/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:17:52.275 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dwd_gzg_log_mb_behavior_di","locations":[{"taskCode":159747555652192,"x":100,"y":100}],"taskDefinitionJson":[{"code":159747555652192,"version":0,"name":"SHELL1765433872273","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- ##################################################################################################################\n-- 输出表：cdm.dwd_gzg_log_mb_behavior_di\n-- 输入表：ods.ods_mb_behavior_di_0log\n-- 操作者：bzh\n-- 创建时间：2018-11/29\n-- 作业方式：每日分区/增量\n--对应实时表 cdm.dwd_gzg_log_mb_behavior_rt\n-- ##################################################################################################################\n-- 修改时间 2022年9月6日15:11:23\n\ninsert overwrite table cdm.dwd_gzg_log_mb_behavior_di partition (dt)\nselect hash_id\n     , id\n     , case\n           when user_number rlike '^(GZ|AZ)([A-Z0-9])+$' then user_number\n           when user_number rlike '^[0-9]+$' then default.get_userNumber(cast(user_number as bigint))\n    end                                                 as user_number\n     , case\n           when user_number rlike '^(GZ|AZ)([A-Z0-9])+$' then default.get_userId(user_number)\n           when user_number rlike '^[0-9]+$' then cast(user_number as bigint)\n    end                                                 as user_id\n     , opentime\n     , createtime\n     , application\n     , third_app\n     , platform\n     , browser_type\n     , url\n     , column_id\n     , from_user_id\n     , from_id\n     , from_guid\n     , from_sign_id\n     , target_id\n     , frameid\n     , to_frameid\n     , to_resourceid\n     , to_scode\n     , info\n     , order_id\n     , coalesce(product_id, product_code, u_product_id) as product_id\n     , circle_id\n     , task_id\n     , tenant_id\n     , activity_name\n     , dt\nfrom (\n         select case when map_col['hash_id'] = '' then null else map_col['hash_id'] end             as hash_id\n              , case when map_col['id'] = '' then null else map_col['id'] end                       as id\n              , case when map_col['opentime'] = '' then null else map_col['opentime'] end           as opentime\n              , case when map_col['createtime'] = '' then null else map_col['createtime'] end       as createtime\n              , case when map_col['application'] = '' then null else map_col['application'] end     as application\n              , case when map_col['third_app'] = '' then null else map_col['third_app'] end         as third_app\n              , case when map_col['platform'] = '' then null else map_col['platform'] end           as platform\n              , case when map_col['browser_type'] = '' then null else map_col['browser_type'] end   as browser_type\n              , case when map_col['url'] = '' then null else map_col['url'] end                     as url\n              , case when map_col['column_id'] = '' then null else map_col['column_id'] end         as column_id\n              , case when map_col['from_user_id'] = '' then null else map_col['from_user_id'] end   as from_user_id\n              , case when map_col['from_id'] = '' then null else map_col['from_id'] end             as from_id\n              , case when map_col['from_guid'] = '' then null else map_col['from_guid'] end         as from_guid\n              , case when map_col['from_sign_id'] = '' then null else map_col['from_sign_id'] end   as from_sign_id\n              , case when map_col['target_id'] = '' then null else map_col['target_id'] end         as target_id\n              , case when map_col['frameid'] = '' then null else map_col['frameid'] end             as frameid\n              , case when map_col['to_frameid'] = '' then null else map_col['to_frameid'] end       as to_frameid\n              , case when map_col['to_resourceid'] = '' then null else map_col['to_resourceid'] end as to_resourceid\n              , case when map_col['to_scode'] = '' then null else map_col['to_scode'] end           as to_scode\n              , case when map_col['circle_id'] = '' then null else map_col['circle_id'] end         as circle_id\n              , case when map_col['info'] = '' then null else map_col['info'] end                   as info\n              , case\n                    when map_col['user_number'] = '' then parse_url(map_col['url'], 'QUERY', 'user_number')\n                    else map_col['user_number']\n             end                                                                                    as user_number\n              , case\n                    when map_col['order_id'] = '' then parse_url(map_col['url'], 'QUERY', 'orderId')\n                    else map_col['order_id']\n             end                                                                                    as order_id\n\n              , case when map_col['product_id'] = '' then null else map_col['product_id'] end       as product_id\n              , case when map_col['product_code'] = '' then null else map_col['product_code'] end   as product_code\n              , coalesce(parse_url(map_col['url'], 'QUERY', 'productCode'), parse_url(map_col['url'], 'QUERY', 'sProductID'), parse_url(map_col['url'], 'QUERY', 'ProductID'))\n                                                                                                    as u_product_id\n              , case when map_col['tenant_id'] = '' then 'YYZQZX' else map_col['tenant_id'] end     as tenant_id\n              , case when map_col['activity_name'] = '' then null else map_col['activity_name'] end as activity_name\n              , coalesce(map_col['task_id'], map_col['taskId'])                                     as task_id\n              , dt\n         from (\n                  select str_to_map(log_str, '\\\\|', '=') as map_col\n                       , dt\n                  from ods.ods_mb_behavior_di_0log\n                  where dt = date_sub('2025-01-01', 1)\n              ) p1\n     ) p1","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159747555652192,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"输出表：cdm.dwd_gzg_log_mb_behavior_di\n输入表：ods.ods_mb_behavior_di_0log\n操作者：bzh\n创建时间：2018-11/29\n作业方式：每日分区/增量\n对应实时表 cdm.dwd_gzg_log_mb_behavior_rt\n\n修改时间 2022年9月6日15:11:23","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:17:52.336 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159747555682912/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:20:22.463 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dwd_gzg_log_app_behavior_di","locations":[{"taskCode":159747709453920,"x":100,"y":100}],"taskDefinitionJson":[{"code":159747709453920,"version":0,"name":"SHELL1765434022460","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- 股掌柜APP-行为数据 对应实时表cdm.dwd_gzg_log_app_behavior_rt\n\ninsert overwrite table cdm.dwd_gzg_log_app_behavior_di PARTITION (dt)\nselect case when p1.account_id rlike '^TS' then '0' else p1.user_id end    as user_id\n     , p1.user_number                                                      as user_number\n     , p1.guid                                                             as guid\n     , p1.`application`                                                      as `application`\n     , p1.version                                                          as version\n     , p1.platform                                                         as platform\n     , p1.page_id                                                          as start_object\n     , p1.object                                                           as objects\n     , from_unixtime(cast(p1.createtime as bigint), 'yyyy-MM-dd HH:mm:ss') as create_time\n     , p1.action_type                                                      as action_type\n     , p1.is_fanhui                                                        as is_return\n     , p1.scode_id                                                         as scode_id\n     , p1.market_id                                                        as market_id\n     , p1.screen_direction                                                 as screen_direction\n     , p1.color                                                            as bgcolor\n     , p1.frameid                                                          as frame_id\n     , p1.type                                                             as log_type\n     , p1.qs_id                                                            as qs_id\n     , p1.from_frameid                                                     as from_frame_id\n     , p1.from_object                                                      as from_object\n     , p1.from_resourceid                                                  as from_resource_id\n     , p1.to_frameid                                                       as to_frame_id\n     , p1.to_resourceid                                                    as to_resource_id\n     , p1.to_scode                                                         as to_scode\n     , p1.account_id                                                       as account_id\n     , p1.event_type                                                       as event_type\n     , p1.target_id                                                        as target_id\n     , p1.user_id                                                          as visitor_id\n     , case when p1.account_id rlike '^TS' then 1 else 0 end               as is_tourist\n     , from_unixtime(cast(p1.opentime as bigint), 'yyyy-MM-dd HH:mm:ss')   as open_time\n     , p1.tenant_id                                                        as tenant_id\n     , p1.p_date                                                           as dt\nfrom (select case when p1.user_id = '' then '0' else p1.user_id end                                  as user_id\n           , case\n                 when p1.user_id = '0' then null\n                 when p1.user_id = '' then null\n                 when p1.user_id < 1000101 then concat('GZ', substr(p1.user_id, 1, 1), substr(p1.user_number, 2, 1),\n                                                       substr(p1.user_id, 3, 1), substr(p1.user_number, 4, 1),\n                                                       substr(p1.user_id, 5, 1), substr(p1.user_number, 6, 1),\n                                                       substr(p1.user_id, 7, 1), substr(p1.user_number, 8, 1),\n                                                       substr(p1.user_id, 9, 1), substr(p1.user_number, 10, 1))\n                 else concat('AZ', substr(p1.user_id, 1, 1), substr(p1.user_number, 2, 1), substr(p1.user_id, 3, 1),\n                             substr(p1.user_number, 4, 1), substr(p1.user_id, 5, 1), substr(p1.user_number, 6, 1),\n                             substr(p1.user_id, 7, 1), substr(p1.user_number, 8, 1), substr(p1.user_id, 9, 1),\n                             substr(p1.user_number, 10, 1))\n        end                                                                                          as user_number\n           , case when p1.guid = '' then null else p1.guid end                                       as guid\n           , case when p1.`application` = '' then null else p1.`application` end                         as `application`\n           , case when p1.version = '' then null else p1.version end                                 as version\n           , case when p1.platform = '' then null else p1.platform end                               as platform\n           , case when split(p1.object, '\\\\.')[0] = '' then null else split(p1.object, '\\\\.')[0] end as page_id\n           , case when p1.object = '' then null else p1.object end                                   as object\n           , case when p1.createtime rlike '^[0-9]+$' then substr(p1.createtime, 1, 10) end          as createtime\n           , case when p1.action_type = '' then null else p1.action_type end                         as action_type\n           , case when p1.is_fanhui = '' then null else p1.is_fanhui end                             as is_fanhui\n           , case when p1.scode_id = '' then null else p1.scode_id end                               as scode_id\n           , case when p1.market_id = '' then null else p1.market_id end                             as market_id\n           , case when p1.screen_direction = '' then null else p1.screen_direction end               as screen_direction\n           , case when p1.color = '' then null else p1.color end                                     as color\n           , case when p1.frameid = '' then null else p1.frameid end                                 as frameid\n           , case when p1.type = '' then null else p1.type end                                       as type\n           , case when p1.qs_id = '' then null else p1.qs_id end                                     as qs_id\n           , case when p1.from_frameid = '' then null else p1.from_frameid end                       as from_frameid\n           , case when p1.from_object = '' then null else p1.from_object end                         as from_object\n           , case when p1.from_resourceid = '' then null else p1.from_resourceid end                 as from_resourceid\n           , case when p1.to_frameid = '' then null else p1.to_frameid end                           as to_frameid\n           , case when p1.to_resourceid = '' then null else p1.to_resourceid end                     as to_resourceid\n           , case when p1.to_scode = '' then null else p1.to_scode end                               as to_scode\n           , case when p1.account_id rlike '^(AL|TS)' then p1.account_id end                         as account_id\n           , case when p1.event_type = '' then null else p1.event_type end                           as event_type\n           , case when p1.target_id = '' then null else p1.target_id end                             as target_id\n           , case when p1.opentime rlike '^[0-9]+$' then substr(p1.opentime, 1, 10) end              as opentime\n           , 'YYZQZX'                                                                                as tenant_id\n           , p1.p_date\n      from (select case\n                       when log_str rlike '^user_id=' then regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|user_id=' then regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1)\n          end           as user_id\n                 , case\n                       when log_str rlike '^guid=' then regexp_extract(log_str, '^guid=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|guid=' then regexp_extract(log_str, '\\\\|guid=([^\\\\|]*)', 1)\n              end       as guid\n                 , case\n                       when log_str rlike '^application=' then regexp_extract(log_str, '^application=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|application=' then regexp_extract(log_str, '\\\\|application=([^\\\\|]*)', 1)\n              end       as `application`\n                 , case\n                       when log_str rlike '^version=' then regexp_extract(log_str, '^version=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|version=' then regexp_extract(log_str, '\\\\|version=([^\\\\|]*)', 1)\n              end       as version\n                 , case\n                       when log_str rlike '^platform=' then regexp_extract(log_str, '^platform=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|platform=' then regexp_extract(log_str, '\\\\|platform=([^\\\\|]*)', 1)\n              end       as platform\n                 , case\n                       when log_str rlike '^object=' then regexp_extract(log_str, '^object=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|object=' then regexp_extract(log_str, '\\\\|object=([^\\\\|]*)', 1)\n              end       as object\n                 , case\n                       when log_str rlike '^createtime=' then regexp_extract(log_str, '^createtime=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|createtime=' then regexp_extract(log_str, '\\\\|createtime=([^\\\\|]*)', 1)\n              end       as createtime\n                 , case\n                       when log_str rlike '^action_type=' then regexp_extract(log_str, '^action_type=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|action_type=' then regexp_extract(log_str, '\\\\|action_type=([^\\\\|]*)', 1)\n              end       as action_type\n                 , case\n                       when log_str rlike '^is_fanhui=' then regexp_extract(log_str, '^is_fanhui=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|is_fanhui=' then regexp_extract(log_str, '\\\\|is_fanhui=([^\\\\|]*)', 1)\n              end       as is_fanhui\n                 , case\n                       when log_str rlike '^scode_id=' then regexp_extract(log_str, '^scode_id=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|scode_id=' then regexp_extract(log_str, '\\\\|scode_id=([^\\\\|]*)', 1)\n              end       as scode_id\n                 , case\n                       when log_str rlike '^market_id=' then regexp_extract(log_str, '^market_id=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|market_id=' then regexp_extract(log_str, '\\\\|market_id=([^\\\\|]*)', 1)\n              end       as market_id\n                 , case\n                       when log_str rlike '^screen_direction='\n                           then regexp_extract(log_str, '^screen_direction=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|screen_direction='\n                           then regexp_extract(log_str, '\\\\|screen_direction=([^\\\\|]*)', 1)\n              end       as screen_direction\n                 , case\n                       when log_str rlike '^color=' then regexp_extract(log_str, '^color=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|color=' then regexp_extract(log_str, '\\\\|color=([^\\\\|]*)', 1)\n              end       as color\n                 , case\n                       when log_str rlike '^frameid=' then regexp_extract(log_str, '^frameid=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|frameid=' then regexp_extract(log_str, '\\\\|frameid=([^\\\\|]*)', 1)\n              end       as frameid\n                 , case\n                       when log_str rlike '^type=' then regexp_extract(log_str, '^type=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|type=' then regexp_extract(log_str, '\\\\|type=([^\\\\|]*)', 1)\n              end       as type\n                 , case\n                       when log_str rlike '^qs_id=' then regexp_extract(log_str, '^qs_id=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|qs_id=' then regexp_extract(log_str, '\\\\|qs_id=([^\\\\|]*)', 1)\n              end       as qs_id\n                 , case\n                       when log_str rlike '^from_frameid=' then regexp_extract(log_str, '^from_frameid=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|from_frameid='\n                           then regexp_extract(log_str, '\\\\|from_frameid=([^\\\\|]*)', 1)\n              end       as from_frameid\n                 , case\n                       when log_str rlike '^from_object=' then regexp_extract(log_str, '^from_object=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|from_object=' then regexp_extract(log_str, '\\\\|from_object=([^\\\\|]*)', 1)\n              end       as from_object\n                 , case\n                       when log_str rlike '^from_resourceid='\n                           then regexp_extract(log_str, '^from_resourceid=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|from_resourceid='\n                           then regexp_extract(log_str, '\\\\|from_resourceid=([^\\\\|]*)', 1)\n              end       as from_resourceid\n                 , case\n                       when log_str rlike '^to_frameid=' then regexp_extract(log_str, '^to_frameid=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|to_frameid=' then regexp_extract(log_str, '\\\\|to_frameid=([^\\\\|]*)', 1)\n              end       as to_frameid\n                 , case\n                       when log_str rlike '^to_resourceid=' then regexp_extract(log_str, '^to_resourceid=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|to_resourceid='\n                           then regexp_extract(log_str, '\\\\|to_resourceid=([^\\\\|]*)', 1)\n              end       as to_resourceid\n                 , case\n                       when log_str rlike '^to_scode=' then regexp_extract(log_str, '^to_scode=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|to_scode=' then regexp_extract(log_str, '\\\\|to_scode=([^\\\\|]*)', 1)\n              end       as to_scode\n                 , case\n                       when log_str rlike '^target_id=' then regexp_extract(log_str, '^target_id=([^\\\\|]*)', 1)\n                       when log_str rlike '\\\\|target_id=' then regexp_extract(log_str, '\\\\|target_id=([^\\\\|]*)', 1)\n              end       as target_id\n                 , null as account_id\n                 , null as event_type\n                 , null as opentime\n                 , case\n                       when log_str rlike '^user_id=' and\n                            cast(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1) as bigint) <= 523000\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1),'0','A'),'1', 'C'),'2', 'E'), '3', 'G'),'4', 'I'), '5', 'K'), '6', 'M'), '7','O'), '8', 'Q'), '9', 'S')\n                       when log_str rlike '^user_id=' and\n                            cast(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1) as bigint) > 523000\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1),'0','A'),'1', 'V'),'2', 'E'), '3', 'T'),'4', 'X'), '5', 'K'), '6', 'M'), '7','H'), '8', 'N'), '9', 'S')\n                       when log_str rlike '\\\\|user_id=' and\n                            cast(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1) as bigint) <= 523000\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1),'0','A'),'1', 'C'),'2', 'E'), '3', 'G'),'4', 'I'), '5', 'K'), '6', 'M'), '7','O'), '8', 'Q'), '9', 'S')\n                       when log_str rlike '\\\\|user_id=' and\n                            cast(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1) as bigint) > 523000\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1),'0','A'),'1', 'V'),'2', 'E'), '3', 'T'),'4', 'X'), '5', 'K'), '6', 'M'), '7','H'), '8', 'N'), '9', 'S')\n              end       as user_number\n                 , dt   as p_date\n            from ods.ods_app_behavior_di_0log\n            where (log_str rlike '^guid=' or log_str rlike '\\\\|guid=')\n              and dt = date_sub('2025-01-01', 1)\n            union all\n            select case\n                       when split(log_str, '\\\\|')[0] rlike '^([0-9]+)$'\n                           then split(log_str, '\\\\|')[0]\n                       when split(log_str, '\\\\|')[0] rlike '^(GZ|AZ)([A-Z0-9])+$'\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(split(log_str, '\\\\|')[0],'^(GZ|AZ)(([A-Z0-9])+)$',2),'A','0'),'C','1'),'E','2'),'G','3'),'I','4'),'K','5'),'M','6'),'O','7'),'Q','8'),'S','9'),'V','1'),'T','3'),'X','4'),'H', '7'),'N', '8')\n                       else '0'\n                end                          as user_id\n                 , split(log_str, '\\\\|')[1]  as guid\n                 , split(log_str, '\\\\|')[2]  as `application`\n                 , split(log_str, '\\\\|')[3]  as version\n                 , split(log_str, '\\\\|')[4]  as platform\n                 , split(log_str, '\\\\|')[5]  as object\n                 , split(log_str, '\\\\|')[6]  as createtime\n                 , split(log_str, '\\\\|')[7]  as action_type\n                 , split(log_str, '\\\\|')[8]  as is_fanhui\n                 , split(log_str, '\\\\|')[9]  as scode_id\n                 , split(log_str, '\\\\|')[10] as market_id\n                 , split(log_str, '\\\\|')[11] as screen_direction\n                 , split(log_str, '\\\\|')[12] as color\n                 , split(log_str, '\\\\|')[13] as frameid\n                 , split(log_str, '\\\\|')[14] as type\n                 , split(log_str, '\\\\|')[15] as qs_id\n                 , split(log_str, '\\\\|')[16] as from_frameid\n                 , split(log_str, '\\\\|')[17] as from_object\n                 , split(log_str, '\\\\|')[18] as from_resourceid\n                 , split(log_str, '\\\\|')[19] as to_frameid\n                 , split(log_str, '\\\\|')[20] as to_resourceid\n                 , split(log_str, '\\\\|')[21] as to_scode\n                 , split(log_str, '\\\\|')[22] as target_id\n                 , split(log_str, '\\\\|')[23] as account_id\n                 , split(log_str, '\\\\|')[24] as event_type\n                 , split(log_str, '\\\\|')[25] as opentime\n                 , case\n                       when split(log_str, '\\\\|')[0] rlike '^(GZ|AZ)([A-Z0-9])+$'\n                           then regexp_extract(split(log_str, '\\\\|')[0], '^(GZ|AZ)(([A-Z0-9])+)$', 2)\n                       when split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' and\n                            cast(split(log_str, '\\\\|')[0] as bigint) <= 523000\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(split(log_str, '\\\\|')[0], '0', 'A'),'1','C'),'2','E'),'3','G'),'4','I'),'5','K'),'6','M'),'7','O'),'8', 'Q'), '9','S')\n                       when split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' and\n                            cast(split(log_str, '\\\\|')[0] as bigint) > 523000\n                           then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(split(log_str, '\\\\|')[0], '0', 'A'),'1','V'),'2','E'),'3','T'),'4','X'),'5','K'),'6','M'),'7','H'),'8', 'N'), '9','S')\n                end                          as user_number\n                 , dt                        as p_date\n            from ods.ods_app_behavior_di_0log\n            where (split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' or\n                   split(log_str, '\\\\|')[0] rlike '^(GZ|AZ)([A-Z0-9])+$' or log_str rlike '^\\\\|')\n              and dt = date_sub('2025-01-01', 1)\n           ) p1\n     ) p1;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159747709453920,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"股掌柜APP-行为数据 对应实时表cdm.dwd_gzg_log_app_behavior_rt","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:20:22.542 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159747709502048/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:21:47.167 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dwd_gzg_chl_app_source","locations":[{"taskCode":159747796193888,"x":100,"y":100}],"taskDefinitionJson":[{"code":159747796193888,"version":0,"name":"SHELL1765434107166","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- #########################################################\n-- 表名： cdm.dwd_gzg_chl_app_source\n-- Output：输出表： cdm.dwd_gzg_chl_app_source\n-- Input:  输入表：ods.ods_db_sscf_app_data_trace_0db,pdw.dim_sscf_user\n-- Author: 操作者: wangdongdong\n-- Create: 时间 2019-03/05\n-- 作业方式: 每日全量\n-- #########################################################\n-- 修改时间 2022-09-26 16:42\n\ninsert overwrite table cdm.dwd_gzg_chl_app_source\nselect t1.id                                                                                  --自增字段标识\n     , t1.guid                                                                                --下载设备guid\n     , nvl(case\n               when regexp_extract(t1.map_col, '\"from_user_id\":\"([^\"]*)\"', 1) = '' then null\n               else regexp_extract(t1.map_col, '\"from_user_id\":\"([^\"]*)\"', 1) end,\n           t2.user_id)                                                        as from_user_id --邀请者user_id\n     , case\n           when regexp_extract(t1.map_col, '\"from_guid\":\"([^\"]*)\"', 1) = '' then null\n           else regexp_extract(t1.map_col, '\"from_guid\":\"([^\"]*)\"', 1) end    as from_guid    --邀请者guid\n     , case\n           when regexp_extract(t1.map_col, '\"from_id\":\"([^\"]*)\"', 1) = '' then null\n           else regexp_extract(t1.map_col, '\"from_id\":\"([^\"]*)\"', 1) end      as from_id      --站内邀请场景标识\n     , case\n           when regexp_extract(t1.map_col, '\"from_sign_id\":\"([^\"]*)\"', 1) = '' then null\n           else regexp_extract(t1.map_col, '\"from_sign_id\":\"([^\"]*)\"', 1) end as from_sign_id --站外邀请场景标识\n     , map_col                                                                                --渠道参数\n     , date_format(t1.create_time, 'yyyy-MM-dd HH:mm:ss')                     as create_time  --创建时间\n     , 'YYZQZX'                                                               as tenant_id\nfrom ods.ods_db_sscf_app_data_trace_0db t1\n         left join\n     cdm.dim_gzg_usr_user_info t2\n     on regexp_extract(t1.map_col, '\"serial_num\":\"([^\"]*)\"', 1) = t2.user_number;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159747796193888,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"表名： cdm.dwd_gzg_chl_app_source\nOutput：输出表： cdm.dwd_gzg_chl_app_source\nInput:  输入表：ods.ods_db_sscf_app_data_trace_0db,pdw.dim_sscf_user\nAuthor: 操作者: wangdongdong\nCreate: 时间 2019-03/05\n作业方式: 每日全量\n\n修改时间 2022-09-26 16:42","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:21:47.222 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159747796219488/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:23:32.470 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dwd_gzg_log_app_em_behavior_di","locations":[{"taskCode":159747904023136,"x":100,"y":100}],"taskDefinitionJson":[{"code":159747904023136,"version":0,"name":"SHELL1765434212469","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- #########################################################\n-- 输出表：cdm.dwd_gzg_log_app_em_behavior_di\n-- 输入表：ods.ods_app_em_behavior_di_0log\n-- 操作者：wangdongdong\n-- 时间：2018-11-28\n-- 作业方式：每日增量/分区\n-- 对应实时表cdm.dwd_gzg_log_app_em_behavior_rt\n-- #########################################################\n\ninsert overwrite table cdm.dwd_gzg_log_app_em_behavior_di PARTITION (dt)\nselect case\n           when log_map['account_id'] not rlike '^TS' and log_map['user_id'] rlike '^([0-9]+)$' then cast(log_map['user_id'] as bigint)\n           when log_map['account_id'] not rlike '^TS' and log_map['user_id'] rlike '^(GZ|AZ)([A-Z0-9])+$' then default.get_userId(log_map['user_id'])\n    end                                                                                                as user_id\n     , case\n           when log_map['user_id'] rlike '^(GZ|AZ)([A-Z0-9])+$' then log_map['user_id']\n           when log_map['user_id'] rlike '^([0-9]+)$' then default.get_userNumber(cast(log_map['user_id'] as bigint))\n    end                                                                                                as user_number\n     , case when log_map['guid'] = '' then null else log_map['guid'] end                               as guid\n     , case when log_map['application'] = '' then null else log_map['application'] end                 as application\n     , case when log_map['version'] = '' then null else log_map['version'] end                         as version\n     , case when log_map['platform'] = '' then null else log_map['platform'] end                       as platform\n     , case when split(log_map['id'], '\\\\.')[0] = '' then null else split(log_map['id'], '\\\\.')[0] end as page_id\n     , case when log_map['id'] = '' then null else log_map['id'] end                                   as objects\n     , from_unixtime(cast(substr(log_map['createtime'], 1, 10) as bigint))                             as create_time\n     , from_unixtime(cast(substr(log_map['opentime'], 1, 10) as bigint))                               as open_time\n     , case when log_map['action_type'] = '' then null else log_map['action_type'] end                 as action_type\n     , case when log_map['is_fanhui'] = '' then null else log_map['is_fanhui'] end                     as is_return\n     , case when log_map['scode_id'] = '' then null else log_map['scode_id'] end                       as scode_id\n     , case when log_map['market_id'] = '' then null else log_map['market_id'] end                     as market_id\n     , case when log_map['screen_direction'] = '' then null else log_map['screen_direction'] end       as screen_direction\n     , case when log_map['color'] = '' then null else log_map['color'] end                             as bgcolor\n     , case when log_map['frameid'] = '' then null else log_map['frameid'] end                         as frame_id\n     , case when log_map['task_id'] = '' then null else log_map['task_id'] end                         as task_id\n     , case when log_map['from_frameid'] = '' then null else log_map['from_frameid'] end               as from_frame_id\n     , case when log_map['from_object'] = '' then null else log_map['from_object'] end                 as from_object\n     , case when log_map['from_resourceid'] = '' then null else log_map['from_resourceid'] end         as from_resource_id\n     , case when log_map['to_frameid'] = '' then null else log_map['to_frameid'] end                   as to_frame_id\n     , case when log_map['to_resourceid'] = '' then null else log_map['to_resourceid'] end             as to_resource_id\n     , case when log_map['to_scode'] = '' then null else log_map['to_scode'] end                       as to_scode\n     , case when log_map['order_id'] = '' then null else log_map['order_id'] end                       as order_id\n     , case when log_map['activity_id'] = '' then null else log_map['activity_id'] end                 as activity_id\n     , case when log_map['account_id'] rlike '^(AL|TS)' then log_map['account_id'] end                 as account_id\n     , case when log_map['event_type'] = '' then null else log_map['event_type'] end                   as event_type\n     , p1.other_map                                                                                    as log_map\n     , case\n           when log_map['user_id'] rlike '^([0-9]+)$' then cast(log_map['user_id'] as bigint)\n           when log_map['user_id'] rlike '^(GZ|AZ)([A-Z0-9])+$' then default.get_userId(log_map['user_id'])\n    end                                                                                                as visitor_id\n     , case when log_map['account_id'] rlike '^TS' then 1 else 0 end                                   as is_tourist\n     , 'YYZQZX'                                                                                        as tenant_id\n     , case when p1.log_map['channel'] = '' then null else p1.log_map['channel'] end                   as channel\n     , case\n           when coalesce(p1.log_map['product_id'], p1.log_map['productCode']) = '' then null\n           else coalesce(p1.log_map['product_id'], p1.log_map['productCode'])\n    end                                                                                                as product_id\n     , case when log_map['activity_name'] = '' then null else log_map['activity_name'] end             as activity_name\n     , p1.dt\nfrom (\n         select str_to_map(log_str, '\\\\|', '=') as log_map\n              , other_map\n              , dt\n         from ods.ods_app_em_behavior_di_0log\n         where dt = date_sub('2025-01-01', 1)\n     ) p1;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159747904023136,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"输出表：cdm.dwd_gzg_log_app_em_behavior_di\n输入表：ods.ods_app_em_behavior_di_0log\n操作者：wangdongdong\n时间：2018-11-28\n作业方式：每日增量/分区\n对应实时表cdm.dwd_gzg_log_app_em_behavior_rt","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:23:32.516 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159747904049760/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:24:57.131 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dwd_gzg_log_app_heartbeat_di","locations":[{"taskCode":159747990717024,"x":100,"y":100}],"taskDefinitionJson":[{"code":159747990717024,"version":0,"name":"SHELL1765434297130","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"--  #########################################################\n-- 表名： fact_stock_login_log  \n-- Output：输出表： fact_stock_login_log\n-- Input:  输入表： t_stock_login_log_dt、dim_ip_analysis\n-- Author: 操作者： wangdongdong\n-- Create: 时间 2018-11-28\n-- 作业方式: 每日增量/分区\n-- #########################################################\n-- 修改时间 2022-09-21 10:18\ninsert overwrite table cdm.dwd_gzg_log_app_heartbeat_di  PARTITION (dt)\nselect default.get_userId(p1.user_number)    \t\t\t\t\t\t\t\t as user_id\n     , p1.user_number                                                        as user_number\n     , p1.guid                                                               as guid\n     , from_unixtime(cast(p1.access_time as bigint), 'yyyy-MM-dd HH:mm:ss')  as access_time\n     , from_unixtime(cast(p1.offline_time as bigint), 'yyyy-MM-dd HH:mm:ss') as offline_time\n     , p1.download_channel                                                   as download_channel\n     , p1.client_version                                                     as version\n     , p1.phone_model                                                        as phone_model\n     , p1.phone_system                                                       as os\n     , p1.system_version                                                     as os_version\n     , p1.operator                                                           as operator\n     , p1.network                                                            as network\n     , p1.resolution                                                         as resolution\n     , p1.screen_height                                                      as screen_height\n     , p1.screen_width                                                       as screen_width\n     , p1.mac                                                                as mac\n     , p1.ip                                                                 as sip\n     , p1.province_value                                                     as province\n     , p1.city_value                                                         as city\n     , p1.imei                                                               as imei\n     , p1.iccid                                                              as iccid\n     , p1.meid                                                               as meid\n     , p1.uuid                                                               as uuid\n     , p1.application                                                        as application\n     , p1.deveice_token                                                      as deveice_token\n     , p1.is_reload                                                          as is_reload\n     , p1.android_id                                                         as android_id\n     , p1.idfa                                                               as idfa\n     , p1.oaid                                                               as oaid\n     , p1.account_id                                                         as account_id\n     , default.get_userId(p1.user_number)                                    as visitor_id\n     , case when p1.account_id rlike '^TS' then 1 else 0 end                 as is_tourist\n     , p1.stay_page_id                                                       as stay_page_id\n     , p1.tenant_id                                                          as tenant_id\n     , p1.p_date                                                             as dt\n   from (select case when p1.user_id = '' then '0' else p1.user_id end as user_id\n\t\t\t\t,case when p1.user_id = '0' then null\n\t\t\t\t\t  when p1.user_id = '' then null\n\t\t\t\t\t  when p1.user_id < 1000101 then concat('GZ',substr(p1.user_id,1,1),substr(p1.user_number,2,1),substr(p1.user_id,3,1),substr(p1.user_number,4,1),substr(p1.user_id,5,1),substr(p1.user_number,6,1),substr(p1.user_id,7,1),substr(p1.user_number,8,1),substr(p1.user_id,9,1),substr(p1.user_number,10,1)) \n\t\t\t\t\t  else concat('AZ',substr(p1.user_id,1,1),substr(p1.user_number,2,1),substr(p1.user_id,3,1),substr(p1.user_number,4,1),substr(p1.user_id,5,1),substr(p1.user_number,6,1),substr(p1.user_id,7,1),substr(p1.user_number,8,1),substr(p1.user_id,9,1),substr(p1.user_number,10,1)) \n\t\t\t\t end as user_number\n\t\t\t\t,case when p1.guid = '' then null else p1.guid end as guid\n\t\t\t\t,case when p1.access_time rlike '^[0-9]+$' then substr(p1.access_time, 1, 10) end as access_time\n\t\t\t\t,case when p1.offline_time rlike '^[0-9]+$' then substr(p1.offline_time, 1, 10) end as offline_time\n\t\t\t\t,case when p1.download_channel = '' then null else p1.download_channel end as download_channel\n\t\t\t\t,case when p1.client_version = '' then null else p1.client_version end as client_version\n\t\t\t\t,case when p1.phone_model = '' then null else p1.phone_model end as phone_model\n\t\t\t\t,case when p1.phone_system = '' then null else p1.phone_system end as phone_system\n\t\t\t\t,case when p1.system_version = '' then null else p1.system_version end as system_version\n\t\t\t\t,case when p1.operator = '' then null else p1.operator end as operator\n\t\t\t\t,case when p1.network = '' then null else p1.network end as network\n\t\t\t\t,case when p1.resolution = '' then null else p1.resolution end as resolution\n\t\t\t\t,case when p1.screen_height = '' then null else p1.screen_height end as screen_height\n\t\t\t\t,case when p1.screen_width = '' then null else p1.screen_width end as screen_width\n\t\t\t\t,case when p1.mac = '' then null else p1.mac end as mac\n\t\t\t\t,case when p1.ip = '' then null else p1.ip end as ip\n\t\t\t\t,case when p2.province = '' then null else p2.province end as province_value\n\t\t\t\t,case when p2.city = '' then null else p2.city end as city_value\n\t\t\t\t,case when p1.imei = '' then null else p1.imei end as imei\n\t\t\t\t,case when p1.iccid = '' then null else p1.iccid end as iccid\n\t\t\t\t,case when p1.meid = '' then null else p1.meid end as meid\n\t\t\t\t,case when p1.uuid = '' then null else p1.uuid end as uuid\n\t\t\t\t,case when p1.application = 'gzg_zxb' then p1.application else 'gzg' end as application    \n\t\t\t\t,case when p1.deveice_token = '' then null else p1.deveice_token end as deveice_token\n\t\t\t\t,case when p1.is_reload = '' then null else p1.is_reload end as is_reload\n\t\t\t\t,case when p1.android_id = '' then null else p1.android_id end as android_id\n\t\t\t\t,case when p1.idfa = '' then null else p1.idfa end as idfa\n\t\t\t\t,case when p1.oaid = '' then null else p1.oaid end as oaid\n\t\t\t\t,case when p1.account_id = '' then null else p1.account_id end as account_id\n\t\t\t\t,case when p1.stay_page_id = '' then null else p1.stay_page_id end as stay_page_id\n\t\t\t\t,'YYZQZX' as tenant_id\n\t\t\t\t,p1.p_date\n\t\t   from (select case when log_str rlike '^user_id=' then regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|user_id=' then regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as user_id\n\t\t\t\t\t   ,case when log_str rlike '^guid=' then regexp_extract(log_str, '^guid=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|guid=' then regexp_extract(log_str, '\\\\|guid=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as guid\n\t\t\t\t\t   ,case when log_str rlike '^access_time=' then regexp_extract(log_str, '^access_time=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|access_time=' then regexp_extract(log_str, '\\\\|access_time=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as access_time\n\t\t\t\t\t   ,case when log_str rlike '^offline_time=' then regexp_extract(log_str, '^offline_time=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|offline_time=' then regexp_extract(log_str, '\\\\|offline_time=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as offline_time\n\t\t\t\t\t   ,case when log_str rlike '^download_channel=' then regexp_extract(log_str, '^download_channel=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|download_channel=' then regexp_extract(log_str, '\\\\|download_channel=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as download_channel\n\t\t\t\t\t   ,case when log_str rlike '^client_version=' then regexp_extract(log_str, '^client_version=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|client_version=' then regexp_extract(log_str, '\\\\|client_version=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as client_version\n\t\t\t\t\t   ,case when log_str rlike '^phone_model=' then regexp_extract(log_str, '^phone_model=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|phone_model=' then regexp_extract(log_str, '\\\\|phone_model=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as phone_model\n\t\t\t\t\t   ,case when log_str rlike '^phone_system=' then regexp_extract(log_str, '^phone_system=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|phone_system=' then regexp_extract(log_str, '\\\\|phone_system=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as phone_system\n\t\t\t\t\t   ,case when log_str rlike '^system_version=' then regexp_extract(log_str, '^system_version=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|system_version=' then regexp_extract(log_str, '\\\\|system_version=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as system_version\n\t\t\t\t\t   ,case when log_str rlike '^operator=' then regexp_extract(log_str, '^operator=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|operator=' then regexp_extract(log_str, '\\\\|operator=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as operator\n\t\t\t\t\t   ,case when log_str rlike '^network=' then regexp_extract(log_str, '^network=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|network=' then regexp_extract(log_str, '\\\\|network=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as network\n\t\t\t\t\t   ,case when log_str rlike '^resolution=' then regexp_extract(log_str, '^resolution=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|resolution=' then regexp_extract(log_str, '\\\\|resolution=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as resolution\n\t\t\t\t\t   ,case when log_str rlike '^screen_height=' then regexp_extract(log_str, '^screen_height=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|screen_height=' then regexp_extract(log_str, '\\\\|screen_height=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as screen_height\n\t\t\t\t\t   ,case when log_str rlike '^screen_width=' then regexp_extract(log_str, '^screen_width=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|screen_width=' then regexp_extract(log_str, '\\\\|screen_width=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as screen_width\n\t\t\t\t\t   ,case when log_str rlike '^mac=' then regexp_extract(log_str, '^mac=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|mac=' then regexp_extract(log_str, '\\\\|mac=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as mac\n\t\t\t\t\t   ,case when log_str rlike '^imei=' then regexp_extract(log_str, '^imei=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|imei=' then regexp_extract(log_str, '\\\\|imei=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as imei\n\t\t\t\t\t   ,case when log_str rlike '^iccid=' then regexp_extract(log_str, '^iccid=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|iccid=' then regexp_extract(log_str, '\\\\|iccid=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as iccid\n\t\t\t\t\t   ,case when log_str rlike '^meid=' then regexp_extract(log_str, '^meid=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|meid=' then regexp_extract(log_str, '\\\\|meid=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as meid\n\t\t\t\t\t   ,case when log_str rlike '^idfa=' then regexp_extract(log_str, '^idfa=([^\\\\|]*)', 1)\n\t\t\t\t\t\t\t when log_str rlike '\\\\|idfa=' then regexp_extract(log_str, '\\\\|idfa=([^\\\\|]*)', 1)\n\t\t\t\t\t\tend as uuid\n\t\t\t\t\t   ,null as application\n\t\t\t\t\t   ,null as deveice_token\n\t\t\t\t\t   ,null as is_reload\n\t\t\t\t\t   ,null as android_id\n\t\t\t\t\t   ,null as idfa\n\t\t\t\t\t   ,null as oaid\n\t\t\t\t\t   ,null as account_id\n\t\t\t\t\t   ,null as stay_page_id\n\t\t\t\t\t   ,case when log_str rlike '^user_id=' and cast(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1) as bigint) <= 523000 then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1), '0', 'A'), '1', 'C'), '2', 'E'), '3', 'G'), '4', 'I'), '5', 'K'), '6', 'M'), '7', 'O'), '8', 'Q'), '9', 'S')\n\t\t\t\t\t         when log_str rlike '^user_id=' and cast(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1) as bigint) >  523000 then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '^user_id=([^\\\\|]*)', 1), '0', 'A'), '1', 'V'), '2', 'E'), '3', 'T'), '4', 'X'), '5', 'K'), '6', 'M'), '7', 'H'), '8', 'N'), '9', 'S')\n\t\t\t\t\t\t\t when log_str rlike '\\\\|user_id=' and cast(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1) as bigint) <= 523000 then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1), '0', 'A'), '1', 'C'), '2', 'E'), '3', 'G'), '4', 'I'), '5', 'K'), '6', 'M'), '7', 'O'), '8', 'Q'), '9', 'S')\n\t\t\t\t\t\t\t when log_str rlike '\\\\|user_id=' and cast(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1) as bigint) >  523000 then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(log_str, '\\\\|user_id=([^\\\\|]*)', 1), '0', 'A'), '1', 'V'), '2', 'E'), '3', 'T'), '4', 'X'), '5', 'K'), '6', 'M'), '7', 'H'), '8', 'N'), '9', 'S')\n\t\t\t\t\t\tend as user_number\n\t\t\t\t\t   ,sip as ip\n\t\t\t\t\t   ,dt as p_date\n\t\t\t\t\t   ,'2' as type\n\t\t\t\t  from ods.ods_app_heartbeat_di_0log \n\t\t\t\t where dt = date_sub('2025-01-01', 1)\n\t\t\t\t   and (log_str rlike '^guid=' or log_str rlike '\\\\|guid=')\n\t\t\t\t union all\n\t\t\t\tselect case when split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' then split(log_str, '\\\\|')[0] \n\t\t\t\t\t\t\twhen split(log_str, '\\\\|')[0] rlike '^(GZ|AZ)([A-Z0-9])+$' then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(regexp_extract(split(log_str, '\\\\|')[0], '^(GZ|AZ)(([A-Z0-9])+)$', 2), 'A', '0'), 'C', '1'), 'E', '2'), 'G', '3'), 'I', '4'), 'K', '5'), 'M', '6'), 'O', '7'), 'Q', '8'), 'S', '9'), 'V', '1'), 'T', '3'), 'X', '4'), 'H', '7'), 'N', '8')\n\t\t\t\t\t\telse '0' end as user_id\n\t\t\t\t\t   ,split(log_str, '\\\\|')[1] as guid\n\t\t\t\t\t   ,split(log_str, '\\\\|')[2] as access_time\n\t\t\t\t\t   ,split(log_str, '\\\\|')[3] as offline_time\n\t\t\t\t\t   ,split(log_str, '\\\\|')[4] as download_channel\n\t\t\t\t\t   ,split(log_str, '\\\\|')[5] as client_version\n\t\t\t\t\t   ,split(log_str, '\\\\|')[6] as phone_model\n\t\t\t\t\t   ,split(log_str, '\\\\|')[7] as phone_system\n\t\t\t\t\t   ,split(log_str, '\\\\|')[8] as system_version\n\t\t\t\t\t   ,split(log_str, '\\\\|')[9] as operator\n\t\t\t\t\t   ,split(log_str, '\\\\|')[10] as network\n\t\t\t\t\t   ,split(log_str, '\\\\|')[11] as resolution\n\t\t\t\t\t   ,split(log_str, '\\\\|')[12] as screen_height\n\t\t\t\t\t   ,split(log_str, '\\\\|')[13] as screen_width\n\t\t\t\t\t   ,split(log_str, '\\\\|')[14] as mac\n\t\t\t\t\t   ,split(log_str, '\\\\|')[15] as imei\n\t\t\t\t\t   ,split(log_str, '\\\\|')[16] as iccid\n\t\t\t\t\t   ,split(log_str, '\\\\|')[17] as meid\n\t\t\t\t\t   ,split(log_str, '\\\\|')[18] as uuid\n\t\t\t\t\t   ,split(log_str, '\\\\|')[19] as application\n\t\t\t\t\t   ,split(log_str, '\\\\|')[20] as deveice_token\n\t\t\t\t\t   ,split(log_str, '\\\\|')[21] as is_reload\n\t\t\t\t\t   ,split(log_str, '\\\\|')[22] as android_id\n\t\t\t\t\t   ,split(log_str, '\\\\|')[23] as idfa\n\t\t\t\t\t   ,split(log_str, '\\\\|')[24] as oaid\n\t\t\t\t\t   ,case when split(log_str, '\\\\|')[25] rlike '^(AL|TS)' then split(log_str, '\\\\|')[25] else null end as account_id\n\t\t\t\t\t   ,split(log_str, '\\\\|')[26] as stay_page_id\n\t\t\t\t\t   ,case when split(log_str, '\\\\|')[0] rlike '^(GZ|AZ)([A-Z0-9])+$' then regexp_extract(split(log_str, '\\\\|')[0], '^(GZ|AZ)(([A-Z0-9])+)$', 2)\n\t\t\t\t\t\t\t when split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' and cast(split(log_str, '\\\\|')[0] as bigint) <= 523000 then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(split(log_str, '\\\\|')[0], '0', 'A'), '1', 'C'), '2', 'E'), '3', 'G'), '4', 'I'), '5', 'K'), '6', 'M'), '7', 'O'), '8', 'Q'), '9', 'S')\n\t                         when split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' and cast(split(log_str, '\\\\|')[0] as bigint) >  523000 then translate(translate(translate(translate(translate(translate(translate(translate(translate(translate(split(log_str, '\\\\|')[0], '0', 'A'), '1', 'V'), '2', 'E'), '3', 'T'), '4', 'X'), '5', 'K'), '6', 'M'), '7', 'H'), '8', 'N'), '9', 'S')\t\t\t\t\t\n\t\t\t\t\t\tend as user_number\n\t\t\t\t\t   ,sip as ip\n\t\t\t\t\t   ,dt as p_date\n\t\t\t\t\t   ,'1' as type\n\t\t\t\t  from ods.ods_app_heartbeat_di_0log \n\t\t\t\t where dt = date_sub('2025-01-01', 1)\n\t\t\t\t   and (split(log_str, '\\\\|')[0] rlike '^([0-9]+)$' or split(log_str, '\\\\|')[0] rlike '^(GZ|AZ)([A-Z0-9])+$' or log_str rlike '^\\\\|')\n\t\t\t\t) p1\n\t\t   left join\n\t\t\t\tcdm.dim_gzg_pub_ip_location_info p2\n\t\t\t on p1.ip = p2.ip\n\t\t) p1;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159747990717024,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"表名： fact_stock_login_log\nOutput：输出表： fact_stock_login_log\nInput:  输入表： t_stock_login_log_dt、dim_ip_analysis\nAuthor: 操作者： wangdongdong\nCreate: 时间 2018-11-28\n作业方式: 每日增量/分区\n\n修改时间 2022-09-21 10:18","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:24:57.192 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159747990757984/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:26:11.853 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dws_gzg_usr_user_login_di","locations":[{"taskCode":159748067234400,"x":100,"y":100}],"taskDefinitionJson":[{"code":159748067234400,"version":0,"name":"SHELL1765434371852","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"-- #########################################################\n-- Author: 操作者： wangdongdong\n-- Create: 时间 2018-11-28\n-- 作业方式: 每日增量/分区\n-- #########################################################\n-- 修改时间 2022-09-27 17:48\ninsert overwrite table cdm.dws_gzg_usr_user_login_di  PARTITION (dt)\nselect default.get_userId(p1.user_number) user_id\n       ,p1.user_number\n\t   ,p1.guid\n\t   ,p2.access_time_list   --启动时间\n\t   ,p2.start_times\n\t   ,p2.online_time_list   --在线时间\n\t   ,p2.total_online_time  --新增字段，当天用户在线总时长。\n\t   ,p1.download_channel\n\t   ,p1.version\n\t   ,p1.phone_model\n\t   ,case when p1.os in ('iOS', 'iPhone OS') or p1.download_channel = 'appstore' then 'ios' else coalesce(p1.os, 'android') end as os\n\t   ,p1.os_version\n\t   ,p1.operator\n\t   ,p1.network\n\t   ,p1.resolution\n\t   ,p1.screen_height\n\t   ,p1.screen_width\n\t   ,p1.mac\n\t   ,p1.sip as ip\n\t   ,p1.province\n\t   ,p1.city\n\t   ,case when p1.dt = p3.min_first_login_date then 1 else 0 end as is_new  --是否新增设备\n\t   ,p3.min_first_login_date as first_login_date --首次登陆日期\n\t   ,p1.imei\n\t   ,p1.iccid\n\t   ,p1.meid\n\t   ,p1.uuid\n\t   ,p1.application\n\t   ,p1.deveice_token   --新增\n\t   ,case when p2.is_reload = 1 then p2.is_reload else 0 end as is_reload       --是否卸载重装\n\t   ,p1.android_id      --新增\n\t   ,case when p1.dt = p3.first_login_date then 1 else 0 end as is_application_new  --是否应用新增设备\n\t   ,p1.idfa\n\t   ,p1.oaid\n\t   ,p1.account_id\n\t   ,p1.visitor_id\n\t   ,p1.is_tourist\n\t   ,p1.tenant_id\n\t   ,p1.dt     --分区字段   \n  from (select p1.user_id\n\t\t\t   ,p1.user_number\n\t\t\t   ,p1.guid\n\t\t\t   ,p1.download_channel\n\t\t\t   ,p1.version\n\t\t\t   ,p1.phone_model\n\t\t\t   ,p1.os\n\t\t\t   ,p1.os_version\n\t\t\t   ,p1.operator\n\t\t\t   ,p1.network\n\t\t\t   ,p1.resolution\n\t\t\t   ,p1.screen_height\n\t\t\t   ,p1.screen_width\n\t\t\t   ,p1.mac\n\t\t\t   ,p1.sip\n\t\t\t   ,p1.province\n\t\t\t   ,p1.city\n\t\t\t   ,p1.imei\n\t\t\t   ,p1.iccid\n\t\t\t   ,p1.meid\n\t\t\t   ,p1.uuid\n\t\t\t   ,p1.application\n\t\t\t   ,p1.deveice_token  \n\t\t\t   ,p1.android_id     \n\t\t\t   ,p1.idfa\n\t\t\t   ,p1.oaid\n\t\t\t   ,p1.account_id\n\t\t\t   ,p1.visitor_id\n\t\t\t   ,p1.is_tourist\n\t\t\t   ,p1.tenant_id\n\t\t\t   ,p1.dt\n\t\t  from (select user_id\n\t\t               ,user_number\n\t\t\t\t\t   ,guid\n\t\t\t\t\t   ,download_channel\n\t\t\t\t\t   ,version\n\t\t\t\t\t   ,phone_model\n\t\t\t\t\t   ,os\n\t\t\t\t\t   ,os_version\n\t\t\t\t\t   ,operator\n\t\t\t\t\t   ,network\n\t\t\t\t\t   ,resolution\n\t\t\t\t\t   ,screen_height\n\t\t\t\t\t   ,screen_width\n\t\t\t\t\t   ,mac\n\t\t\t\t\t   ,sip\n\t\t\t\t\t   ,province\n\t\t\t\t\t   ,city\n\t\t\t\t\t   ,imei\n\t\t\t\t\t   ,iccid\n\t\t\t\t\t   ,meid\n\t\t\t\t\t   ,uuid\n\t\t\t\t\t   ,application\n\t\t\t\t\t   ,deveice_token  \n\t\t\t\t\t   ,android_id     \n\t\t\t\t\t   ,idfa\n\t\t\t\t\t   ,oaid\n\t\t\t\t\t   ,account_id\n\t\t\t\t\t   ,visitor_id\n\t\t\t\t\t   ,is_tourist\n\t\t\t\t\t   ,tenant_id\n\t\t\t\t\t   ,dt\n\t\t\t\t\t   ,row_number()over(partition by dt, tenant_id, guid, application order by coalesce(unix_timestamp(offline_time), unix_timestamp(access_time)) desc) as num\n\t\t\t\tfrom cdm.dwd_gzg_log_app_heartbeat_di                                         \n\t\t\t   where dt = date_sub('2025-01-01',1)\n\t\t\t\t and guid is not null\n\t\t\t   ) p1\n\t\twhere p1.num = 1\n\t\t) p1\n   left join\n\t\t(select p1.hp_stat_date\n\t\t\t\t,p1.guid\n\t\t\t\t,p1.application\n\t\t\t\t,p1.tenant_id\n\t\t\t\t,max(p1.is_reload) as is_reload\n\t\t\t\t,count(distinct p1.access_time) as start_times\n\t\t\t\t,collect_list(p1.access_time) as access_time_list\n\t\t\t\t,collect_list(unix_timestamp(coalesce(p1.offline_time, p1.access_time)) - unix_timestamp(p1.access_time)) as online_time_list\n\t\t\t\t,sum(unix_timestamp(coalesce(p1.offline_time, p1.access_time)) - unix_timestamp(p1.access_time)) as total_online_time             --新增字段，当天在线总时长。\n\t\t   from db_temp_dt.dws_user_login_online_state_dd p1\n\t\t  where hp_stat_date = date_sub('2025-01-01',1)\n\t   group by p1.hp_stat_date\n\t\t\t\t,p1.guid\n\t\t\t\t,p1.application\n\t\t\t\t,p1.tenant_id\n\t\t) p2\n\t on p1.dt = p2.hp_stat_date\n\tand p1.guid = p2.guid\n\tand p1.application = p2.application\n\tand p1.tenant_id = p2.tenant_id\n   left join\n\t\t(select p1.guid\n\t\t\t\t,p1.application\n\t\t\t\t,p1.tenant_id\n\t\t\t\t,p1.first_login_date\n\t\t\t\t,min(p1.first_login_date)over(partition by p1.guid, p1.tenant_id) as min_first_login_date\n\t\t   from (select guid\n\t\t                ,tenant_id\n\t\t\t\t        ,map_col['application'] as application\n\t\t\t            ,min(first_login_date) as first_login_date\n\t\t           from cdm.dim_gzg_usr_temp_user_info_df \n                   where dt = date_sub('2025-01-01',1)\n\t\t          group by guid\n\t\t                   ,map_col['application']\n\t\t\t\t\t\t   ,tenant_id\n\t\t\t\t) p1 \t\n\t\t) p3\n\t on p1.guid = p3.guid\n\tand p1.application = p3.application\n\tand p1.tenant_id = p3.tenant_id;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159748067234400,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"Author: 操作者： wangdongdong\nCreate: 时间 2018-11-28\n作业方式: 每日增量/分区\n\n修改时间 2022-09-27 17:48","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:26:11.893 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159748067255904/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:27:10.878 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dim_gzg_pub_ip_location_info","locations":[{"taskCode":159748127678048,"x":100,"y":100}],"taskDefinitionJson":[{"code":159748127678048,"version":0,"name":"SHELL1765434430877","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"--昨日全部ip\nwith all_ip as (\nselect\n    sip as ip\nfrom\n    (select ip as sip\n    from ods.ods_db_user_t_account_resigter_info_0db\n    where ip <> ''\n    and ip rlike '\\\\.'\n    and ip not rlike 'http'\n    and ip not rlike 'f29'\n    group by ip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    )t\ngroup by \n    sip\n)\n\n--每日ip表临时表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info_temp\nselect\n    ip,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then province\n        else country\n    end as province,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then city\n        else null\n    end as city,\n    date_sub(current_date,1) as dt\nfrom\n    (select\n        ip,\n        case \n            -- 4个直辖市\n            when province like '%北京%' then '北京市'\n            when province like '%上海%' then '上海市'\n            when province like '%天津%' then '天津市'\n            when province like '%重庆%' then '重庆市'\n            -- 2个特别行政区\n            when province like '%香港%' then '香港'\n            when province like '%澳门%' then '澳门'\n            -- 5个自治区\n            when province like '%西藏%' then '西藏自治区'\n            when province like '%内蒙古%' then '内蒙古自治区'\n            when province like '%广西%' then '广西壮族自治区'\n            when province like '%宁夏%' then '宁夏回族自治区'\n            when province like '%新疆%' then '新疆维吾尔自治区'\n            -- 23个省\n            when province like '%湖北%' then '湖北省'\n            when province like '%广东%' then '广东省'\n            when province like '%河南%' then '河南省'\n            when province like '%山东%' then '山东省'\n            when province like '%河北%' then '河北省'\n            when province like '%浙江%' then '浙江省'\n            when province like '%辽宁%' then '辽宁省'\n            when province like '%四川%' then '四川省'\n            when province like '%安徽%' then '安徽省'\n            when province like '%湖南%' then '湖南省'\n            when province like '%陕西%' then '陕西省'\n            when province like '%吉林%' then '吉林省'\n            when province like '%福建%' then '福建省'\n            when province like '%山西%' then '山西省'\n            when province like '%云南%' then '云南省'\n            when province like '%江西%' then '江西省'\n            when province like '%贵州%' then '贵州省'\n            when province like '%甘肃%' then '甘肃省'\n            when province like '%青海%' then '青海省'\n            when province like '%黑龙江%' then '黑龙江省'\n            when province like '%江苏%' then '江苏省'\n            when province like '%海南%' then '海南省'\n            when province like '%台湾%' then '台湾省'\n        else province\n        end as province,\n        case \n            -- 一些需要特殊处理的市\n            when city like '%北京%'    then null\n            when city like '%上海%'    then null\n            when city like '%天津%'    then null\n            when city like '%重庆%'    then null\n            when city like '%香港%'    then null\n            when city like '%澳门%'    then null\n            when city like '%那曲%'    then '那曲市'\n            when city like '%山南%'    then '山南市'\n            when city like '%林芝%'    then '林芝市'\n            when city like '%日喀则%'  then '日喀则市'\n            when city like '%阿里地区%' then '阿里市'\n            when city like '%昌都%'     then '昌都市'\n            when city like '%桂林%'     then '桂林市'\n            when city like '%哈密%'     then '哈密市'\n            when city like '%阿勒泰%'   then '阿勒泰市'\n            when city like '%塔城%'    then '塔城市'\n            when city like '%喀什%'   then '喀什市'\n            when city like '%阿克苏%'  then '阿克苏市'\n            when city like '%和田%'   then '和田市'\n            when city like '%吐鲁番%'  then '吐鲁番市'\n            when city like '%恩施%'   then '恩施市'\n            when city like '%襄阳%'  then '襄阳市'\n            when city like '%汕头%'  then '汕头市'\n            when city like '%济源%'  then '济源市'\n            when city like '%郑州%'  then '郑州市'\n            when city like '%廊坊%'  then '廊坊市'\n            when city like '%朝阳%'  then '朝阳市'\n            when city like '%盘锦%'  then '盘锦市'\n            when city like '%本溪%'  then '本溪市'\n            when city like '%大连%'  then '大连市'\n            when city like '%沈阳%'  then '沈阳市'\n            when city like '%阿坝%'  then '阿坝州'\n            when city like '%蚌埠%'  then '蚌埠市'\n            when city like '%延边%'  then '延边市'\n            when city like '%临汾%'  then '临汾市'\n            when city like '%毕节%'  then '毕节市'\n            when city like '%铜仁%'  then '铜仁市'\n            when city like '%临夏%'  then '临夏市'\n            when city like '%海东%'  then '海东市'\n            when city like '%西宁%'  then '西宁市'\n            when city like '%大兴安岭%'  then '大兴安岭市'\n            when city like '%淮安%'  then '淮安市'\n            when city like '%苏州%'  then '苏州市'\n            when city like '%儋州%'  then '儋州市'\n            when city like '%新北%'  then '新北市'\n            when city like '%台中%'  then '台中市'\n            when city like '%高雄%'  then '高雄市'\n            when city like '%台南%'  then '台南市'\n            when city like '%桃园%'  then '桃园市'\n            when city like '%台北%'  then '台北市'\n            when city like '%南阳%'  then '南阳市'\n            when city = '0' then null\n        else city\n        end as city,\n        country\n    from\n        (select \n            ip,\n            get_json_object(default.get_address(ip), '$.country') as country,\n            get_json_object(default.get_address(ip), '$.province') as province,\n            get_json_object(default.get_address(ip), '$.city') as city\n        from \n            all_ip \n        )t1\n    )t2\nwhere \n    province != '0' and province is not null\n;\n\n--合并全量表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info\nselect\n    ip,\n    province,\n    city,\n    dt\nfrom \n    cdm.dim_gzg_pub_ip_location_info_temp\nunion all\nselect\n    t1.ip,\n    t1.province,\n    t1.city,\n    cast(date_sub(current_date,1) as string) as dt\nfrom\n    cdm.dim_gzg_pub_ip_location_info t1\nleft join\n    cdm.dim_gzg_pub_ip_location_info_temp t2\non \n    (t1.ip = t2.ip)\nwhere \n    t2.ip is null\n;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159748127678048,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"昨日全部ip","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:27:10.924 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159748127706720/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:27:11.031 WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 1406, SQLState: 22001
2025-12-11 14:27:11.031 ERROR o.h.e.jdbc.spi.SqlExceptionHelper - Data truncation: Data too long for column 'source_tables' at row 1
2025-12-11 14:27:11.049 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
org.springframework.dao.DataIntegrityViolationException: could not execute statement [Data truncation: Data too long for column 'source_tables' at row 1] [insert into workflow_deploy (commit_user,create_time,file_content,file_md5,file_name,file_path,project_code,source_tables,target_table,task_codes,task_id,task_name,update_time,workflow_code) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?)]; SQL [insert into workflow_deploy (commit_user,create_time,file_content,file_md5,file_name,file_path,project_code,source_tables,target_table,task_codes,task_id,task_name,update_time,workflow_code) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?)]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:293)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:550)
	at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)
	at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:335)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:152)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at jdk.proxy2/jdk.proxy2.$Proxy141.save(Unknown Source)
	at com.xiaoxj.sqlworkflow.service.SqlLineageService.addTask(SqlLineageService.java:71)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.xiaoxj.sqlworkflow.service.SqlLineageService$$SpringCGLIB$$0.addTask(<generated>)
	at com.xiaoxj.sqlworkflow.controller.DependencyController.addTask(DependencyController.java:59)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.DataException: could not execute statement [Data truncation: Data too long for column 'source_tables' at row 1] [insert into workflow_deploy (commit_user,create_time,file_content,file_md5,file_name,file_path,project_code,source_tables,target_table,task_codes,task_id,task_name,update_time,workflow_code) values (?,?,?,?,?,?,?,?,?,?,?,?,?,?)]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:55)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:197)
	at org.hibernate.id.insert.GetGeneratedKeysDelegate.performInsert(GetGeneratedKeysDelegate.java:107)
	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorPostInsertSingleTable.execute(MutationExecutorPostInsertSingleTable.java:100)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.doStaticInserts(InsertCoordinator.java:175)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.coordinateInsert(InsertCoordinator.java:113)
	at org.hibernate.persister.entity.AbstractEntityPersister.insert(AbstractEntityPersister.java:2868)
	at org.hibernate.action.internal.EntityIdentityInsertAction.execute(EntityIdentityInsertAction.java:81)
	at org.hibernate.engine.spi.ActionQueue.execute(ActionQueue.java:670)
	at org.hibernate.engine.spi.ActionQueue.addResolvedEntityInsertAction(ActionQueue.java:291)
	at org.hibernate.engine.spi.ActionQueue.addInsertAction(ActionQueue.java:272)
	at org.hibernate.engine.spi.ActionQueue.addAction(ActionQueue.java:322)
	at org.hibernate.event.internal.AbstractSaveEventListener.addInsertAction(AbstractSaveEventListener.java:386)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSaveOrReplicate(AbstractSaveEventListener.java:300)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSave(AbstractSaveEventListener.java:219)
	at org.hibernate.event.internal.AbstractSaveEventListener.saveWithGeneratedId(AbstractSaveEventListener.java:134)
	at org.hibernate.event.internal.DefaultPersistEventListener.entityIsTransient(DefaultPersistEventListener.java:175)
	at org.hibernate.event.internal.DefaultPersistEventListener.persist(DefaultPersistEventListener.java:93)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:77)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:54)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127)
	at org.hibernate.internal.SessionImpl.firePersist(SessionImpl.java:754)
	at org.hibernate.internal.SessionImpl.persist(SessionImpl.java:738)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy136.persist(Unknown Source)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy136.persist(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.save(SimpleJpaRepository.java:618)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	... 74 common frames omitted
Caused by: com.mysql.cj.jdbc.exceptions.MysqlDataTruncation: Data truncation: Data too long for column 'source_tables' at row 1
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:104)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1061)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1009)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeLargeUpdate(ClientPreparedStatement.java:1320)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdate(ClientPreparedStatement.java:994)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:194)
	... 124 common frames omitted
2025-12-11 14:28:29.863 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dim_gzg_pub_ip_location_info","locations":[{"taskCode":159748208556640,"x":100,"y":100}],"taskDefinitionJson":[{"code":159748208556640,"version":0,"name":"SHELL1765434509861","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"--昨日全部ip\nwith all_ip as (\nselect\n    sip as ip\nfrom\n    (select ip as sip\n    from ods.ods_db_user_t_account_resigter_info_0db\n    where ip <> ''\n    and ip rlike '\\\\.'\n    and ip not rlike 'http'\n    and ip not rlike 'f29'\n    group by ip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    )t\ngroup by \n    sip\n)\n\n--每日ip表临时表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info_temp\nselect\n    ip,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then province\n        else country\n    end as province,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then city\n        else null\n    end as city,\n    date_sub(current_date,1) as dt\nfrom\n    (select\n        ip,\n        case \n            -- 4个直辖市\n            when province like '%北京%' then '北京市'\n            when province like '%上海%' then '上海市'\n            when province like '%天津%' then '天津市'\n            when province like '%重庆%' then '重庆市'\n            -- 2个特别行政区\n            when province like '%香港%' then '香港'\n            when province like '%澳门%' then '澳门'\n            -- 5个自治区\n            when province like '%西藏%' then '西藏自治区'\n            when province like '%内蒙古%' then '内蒙古自治区'\n            when province like '%广西%' then '广西壮族自治区'\n            when province like '%宁夏%' then '宁夏回族自治区'\n            when province like '%新疆%' then '新疆维吾尔自治区'\n            -- 23个省\n            when province like '%湖北%' then '湖北省'\n            when province like '%广东%' then '广东省'\n            when province like '%河南%' then '河南省'\n            when province like '%山东%' then '山东省'\n            when province like '%河北%' then '河北省'\n            when province like '%浙江%' then '浙江省'\n            when province like '%辽宁%' then '辽宁省'\n            when province like '%四川%' then '四川省'\n            when province like '%安徽%' then '安徽省'\n            when province like '%湖南%' then '湖南省'\n            when province like '%陕西%' then '陕西省'\n            when province like '%吉林%' then '吉林省'\n            when province like '%福建%' then '福建省'\n            when province like '%山西%' then '山西省'\n            when province like '%云南%' then '云南省'\n            when province like '%江西%' then '江西省'\n            when province like '%贵州%' then '贵州省'\n            when province like '%甘肃%' then '甘肃省'\n            when province like '%青海%' then '青海省'\n            when province like '%黑龙江%' then '黑龙江省'\n            when province like '%江苏%' then '江苏省'\n            when province like '%海南%' then '海南省'\n            when province like '%台湾%' then '台湾省'\n        else province\n        end as province,\n        case \n            -- 一些需要特殊处理的市\n            when city like '%北京%'    then null\n            when city like '%上海%'    then null\n            when city like '%天津%'    then null\n            when city like '%重庆%'    then null\n            when city like '%香港%'    then null\n            when city like '%澳门%'    then null\n            when city like '%那曲%'    then '那曲市'\n            when city like '%山南%'    then '山南市'\n            when city like '%林芝%'    then '林芝市'\n            when city like '%日喀则%'  then '日喀则市'\n            when city like '%阿里地区%' then '阿里市'\n            when city like '%昌都%'     then '昌都市'\n            when city like '%桂林%'     then '桂林市'\n            when city like '%哈密%'     then '哈密市'\n            when city like '%阿勒泰%'   then '阿勒泰市'\n            when city like '%塔城%'    then '塔城市'\n            when city like '%喀什%'   then '喀什市'\n            when city like '%阿克苏%'  then '阿克苏市'\n            when city like '%和田%'   then '和田市'\n            when city like '%吐鲁番%'  then '吐鲁番市'\n            when city like '%恩施%'   then '恩施市'\n            when city like '%襄阳%'  then '襄阳市'\n            when city like '%汕头%'  then '汕头市'\n            when city like '%济源%'  then '济源市'\n            when city like '%郑州%'  then '郑州市'\n            when city like '%廊坊%'  then '廊坊市'\n            when city like '%朝阳%'  then '朝阳市'\n            when city like '%盘锦%'  then '盘锦市'\n            when city like '%本溪%'  then '本溪市'\n            when city like '%大连%'  then '大连市'\n            when city like '%沈阳%'  then '沈阳市'\n            when city like '%阿坝%'  then '阿坝州'\n            when city like '%蚌埠%'  then '蚌埠市'\n            when city like '%延边%'  then '延边市'\n            when city like '%临汾%'  then '临汾市'\n            when city like '%毕节%'  then '毕节市'\n            when city like '%铜仁%'  then '铜仁市'\n            when city like '%临夏%'  then '临夏市'\n            when city like '%海东%'  then '海东市'\n            when city like '%西宁%'  then '西宁市'\n            when city like '%大兴安岭%'  then '大兴安岭市'\n            when city like '%淮安%'  then '淮安市'\n            when city like '%苏州%'  then '苏州市'\n            when city like '%儋州%'  then '儋州市'\n            when city like '%新北%'  then '新北市'\n            when city like '%台中%'  then '台中市'\n            when city like '%高雄%'  then '高雄市'\n            when city like '%台南%'  then '台南市'\n            when city like '%桃园%'  then '桃园市'\n            when city like '%台北%'  then '台北市'\n            when city like '%南阳%'  then '南阳市'\n            when city = '0' then null\n        else city\n        end as city,\n        country\n    from\n        (select \n            ip,\n            get_json_object(default.get_address(ip), '$.country') as country,\n            get_json_object(default.get_address(ip), '$.province') as province,\n            get_json_object(default.get_address(ip), '$.city') as city\n        from \n            all_ip \n        )t1\n    )t2\nwhere \n    province != '0' and province is not null\n;\n\n--合并全量表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info\nselect\n    ip,\n    province,\n    city,\n    dt\nfrom \n    cdm.dim_gzg_pub_ip_location_info_temp\nunion all\nselect\n    t1.ip,\n    t1.province,\n    t1.city,\n    cast(date_sub(current_date,1) as string) as dt\nfrom\n    cdm.dim_gzg_pub_ip_location_info t1\nleft join\n    cdm.dim_gzg_pub_ip_location_info_temp t2\non \n    (t1.ip = t2.ip)\nwhere \n    t2.ip is null\n;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159748208556640,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"昨日全部ip","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:28:29.904 ERROR c.x.s.d.workflow.WorkflowOperator - dolphin scheduler response:HttpRestResult(code=10168, msg=workflow definition name dim_gzg_pub_ip_location_info already exists, data=null, success=false, failed=true)
2025-12-11 14:28:29.910 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
com.xiaoxj.sqlworkflow.core.DolphinException: create dolphin scheduler workflow fail
	at com.xiaoxj.sqlworkflow.dolphinscheduler.workflow.WorkflowOperator.create(WorkflowOperator.java:85)
	at com.xiaoxj.sqlworkflow.service.DolphinSchedulerService.createWorkflow(DolphinSchedulerService.java:71)
	at com.xiaoxj.sqlworkflow.controller.DependencyController.addTask(DependencyController.java:53)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: com.xiaoxj.sqlworkflow.core.DolphinException: create dolphin scheduler workflow fail
	at com.xiaoxj.sqlworkflow.dolphinscheduler.workflow.WorkflowOperator.create(WorkflowOperator.java:82)
	... 54 common frames omitted
2025-12-11 14:30:15.791 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dim_gzg_pub_ip_location_info","locations":[{"taskCode":159748317028960,"x":100,"y":100}],"taskDefinitionJson":[{"code":159748317028960,"version":0,"name":"SHELL1765434615790","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"--昨日全部ip\nwith all_ip as (\nselect\n    sip as ip\nfrom\n    (select ip as sip\n    from ods.ods_db_user_t_account_resigter_info_0db\n    where ip <> ''\n    and ip rlike '\\\\.'\n    and ip not rlike 'http'\n    and ip not rlike 'f29'\n    group by ip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    )t\ngroup by \n    sip\n)\n\n--每日ip表临时表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info_temp\nselect\n    ip,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then province\n        else country\n    end as province,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then city\n        else null\n    end as city,\n    date_sub(current_date,1) as dt\nfrom\n    (select\n        ip,\n        case \n            -- 4个直辖市\n            when province like '%北京%' then '北京市'\n            when province like '%上海%' then '上海市'\n            when province like '%天津%' then '天津市'\n            when province like '%重庆%' then '重庆市'\n            -- 2个特别行政区\n            when province like '%香港%' then '香港'\n            when province like '%澳门%' then '澳门'\n            -- 5个自治区\n            when province like '%西藏%' then '西藏自治区'\n            when province like '%内蒙古%' then '内蒙古自治区'\n            when province like '%广西%' then '广西壮族自治区'\n            when province like '%宁夏%' then '宁夏回族自治区'\n            when province like '%新疆%' then '新疆维吾尔自治区'\n            -- 23个省\n            when province like '%湖北%' then '湖北省'\n            when province like '%广东%' then '广东省'\n            when province like '%河南%' then '河南省'\n            when province like '%山东%' then '山东省'\n            when province like '%河北%' then '河北省'\n            when province like '%浙江%' then '浙江省'\n            when province like '%辽宁%' then '辽宁省'\n            when province like '%四川%' then '四川省'\n            when province like '%安徽%' then '安徽省'\n            when province like '%湖南%' then '湖南省'\n            when province like '%陕西%' then '陕西省'\n            when province like '%吉林%' then '吉林省'\n            when province like '%福建%' then '福建省'\n            when province like '%山西%' then '山西省'\n            when province like '%云南%' then '云南省'\n            when province like '%江西%' then '江西省'\n            when province like '%贵州%' then '贵州省'\n            when province like '%甘肃%' then '甘肃省'\n            when province like '%青海%' then '青海省'\n            when province like '%黑龙江%' then '黑龙江省'\n            when province like '%江苏%' then '江苏省'\n            when province like '%海南%' then '海南省'\n            when province like '%台湾%' then '台湾省'\n        else province\n        end as province,\n        case \n            -- 一些需要特殊处理的市\n            when city like '%北京%'    then null\n            when city like '%上海%'    then null\n            when city like '%天津%'    then null\n            when city like '%重庆%'    then null\n            when city like '%香港%'    then null\n            when city like '%澳门%'    then null\n            when city like '%那曲%'    then '那曲市'\n            when city like '%山南%'    then '山南市'\n            when city like '%林芝%'    then '林芝市'\n            when city like '%日喀则%'  then '日喀则市'\n            when city like '%阿里地区%' then '阿里市'\n            when city like '%昌都%'     then '昌都市'\n            when city like '%桂林%'     then '桂林市'\n            when city like '%哈密%'     then '哈密市'\n            when city like '%阿勒泰%'   then '阿勒泰市'\n            when city like '%塔城%'    then '塔城市'\n            when city like '%喀什%'   then '喀什市'\n            when city like '%阿克苏%'  then '阿克苏市'\n            when city like '%和田%'   then '和田市'\n            when city like '%吐鲁番%'  then '吐鲁番市'\n            when city like '%恩施%'   then '恩施市'\n            when city like '%襄阳%'  then '襄阳市'\n            when city like '%汕头%'  then '汕头市'\n            when city like '%济源%'  then '济源市'\n            when city like '%郑州%'  then '郑州市'\n            when city like '%廊坊%'  then '廊坊市'\n            when city like '%朝阳%'  then '朝阳市'\n            when city like '%盘锦%'  then '盘锦市'\n            when city like '%本溪%'  then '本溪市'\n            when city like '%大连%'  then '大连市'\n            when city like '%沈阳%'  then '沈阳市'\n            when city like '%阿坝%'  then '阿坝州'\n            when city like '%蚌埠%'  then '蚌埠市'\n            when city like '%延边%'  then '延边市'\n            when city like '%临汾%'  then '临汾市'\n            when city like '%毕节%'  then '毕节市'\n            when city like '%铜仁%'  then '铜仁市'\n            when city like '%临夏%'  then '临夏市'\n            when city like '%海东%'  then '海东市'\n            when city like '%西宁%'  then '西宁市'\n            when city like '%大兴安岭%'  then '大兴安岭市'\n            when city like '%淮安%'  then '淮安市'\n            when city like '%苏州%'  then '苏州市'\n            when city like '%儋州%'  then '儋州市'\n            when city like '%新北%'  then '新北市'\n            when city like '%台中%'  then '台中市'\n            when city like '%高雄%'  then '高雄市'\n            when city like '%台南%'  then '台南市'\n            when city like '%桃园%'  then '桃园市'\n            when city like '%台北%'  then '台北市'\n            when city like '%南阳%'  then '南阳市'\n            when city = '0' then null\n        else city\n        end as city,\n        country\n    from\n        (select \n            ip,\n            get_json_object(default.get_address(ip), '$.country') as country,\n            get_json_object(default.get_address(ip), '$.province') as province,\n            get_json_object(default.get_address(ip), '$.city') as city\n        from \n            all_ip \n        )t1\n    )t2\nwhere \n    province != '0' and province is not null\n;\n\n--合并全量表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info\nselect\n    ip,\n    province,\n    city,\n    dt\nfrom \n    cdm.dim_gzg_pub_ip_location_info_temp\nunion all\nselect\n    t1.ip,\n    t1.province,\n    t1.city,\n    cast(date_sub(current_date,1) as string) as dt\nfrom\n    cdm.dim_gzg_pub_ip_location_info t1\nleft join\n    cdm.dim_gzg_pub_ip_location_info_temp t2\non \n    (t1.ip = t2.ip)\nwhere \n    t2.ip is null\n;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159748317028960,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"昨日全部ip","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:30:15.842 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159748317059680/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 14:30:15.926 WARN  o.h.e.jdbc.spi.SqlExceptionHelper - SQL Error: 1406, SQLState: 22001
2025-12-11 14:30:15.926 ERROR o.h.e.jdbc.spi.SqlExceptionHelper - Data truncation: Data too long for column 'source_tables' at row 1
2025-12-11 14:30:15.936 ERROR c.x.s.e.GlobalExceptionHandler - Unhandled exception
org.springframework.dao.DataIntegrityViolationException: could not execute statement [Data truncation: Data too long for column 'source_tables' at row 1] [insert into workflow_dependencies (create_time,project_code,source_tables,status,target_table,task_code,task_name,update_time,workflow_code) values (?,?,?,?,?,?,?,?,?)]; SQL [insert into workflow_dependencies (create_time,project_code,source_tables,status,target_table,task_code,task_name,update_time,workflow_code) values (?,?,?,?,?,?,?,?,?)]
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.convertHibernateAccessException(HibernateJpaDialect.java:293)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:241)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:550)
	at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)
	at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:335)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:152)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:164)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:220)
	at jdk.proxy2/jdk.proxy2.$Proxy143.save(Unknown Source)
	at com.xiaoxj.sqlworkflow.service.SqlLineageService.addTask(SqlLineageService.java:79)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.xiaoxj.sqlworkflow.service.SqlLineageService$$SpringCGLIB$$0.addTask(<generated>)
	at com.xiaoxj.sqlworkflow.controller.DependencyController.addTask(DependencyController.java:59)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:255)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:188)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:925)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:830)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:205)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.ServerHttpObservationFilter.doFilterInternal(ServerHttpObservationFilter.java:109)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: org.hibernate.exception.DataException: could not execute statement [Data truncation: Data too long for column 'source_tables' at row 1] [insert into workflow_dependencies (create_time,project_code,source_tables,status,target_table,task_code,task_name,update_time,workflow_code) values (?,?,?,?,?,?,?,?,?)]
	at org.hibernate.exception.internal.SQLExceptionTypeDelegate.convert(SQLExceptionTypeDelegate.java:55)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:58)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:108)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:197)
	at org.hibernate.id.insert.GetGeneratedKeysDelegate.performInsert(GetGeneratedKeysDelegate.java:107)
	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorPostInsertSingleTable.execute(MutationExecutorPostInsertSingleTable.java:100)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.doStaticInserts(InsertCoordinator.java:175)
	at org.hibernate.persister.entity.mutation.InsertCoordinator.coordinateInsert(InsertCoordinator.java:113)
	at org.hibernate.persister.entity.AbstractEntityPersister.insert(AbstractEntityPersister.java:2868)
	at org.hibernate.action.internal.EntityIdentityInsertAction.execute(EntityIdentityInsertAction.java:81)
	at org.hibernate.engine.spi.ActionQueue.execute(ActionQueue.java:670)
	at org.hibernate.engine.spi.ActionQueue.addResolvedEntityInsertAction(ActionQueue.java:291)
	at org.hibernate.engine.spi.ActionQueue.addInsertAction(ActionQueue.java:272)
	at org.hibernate.engine.spi.ActionQueue.addAction(ActionQueue.java:322)
	at org.hibernate.event.internal.AbstractSaveEventListener.addInsertAction(AbstractSaveEventListener.java:386)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSaveOrReplicate(AbstractSaveEventListener.java:300)
	at org.hibernate.event.internal.AbstractSaveEventListener.performSave(AbstractSaveEventListener.java:219)
	at org.hibernate.event.internal.AbstractSaveEventListener.saveWithGeneratedId(AbstractSaveEventListener.java:134)
	at org.hibernate.event.internal.DefaultPersistEventListener.entityIsTransient(DefaultPersistEventListener.java:175)
	at org.hibernate.event.internal.DefaultPersistEventListener.persist(DefaultPersistEventListener.java:93)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:77)
	at org.hibernate.event.internal.DefaultPersistEventListener.onPersist(DefaultPersistEventListener.java:54)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:127)
	at org.hibernate.internal.SessionImpl.firePersist(SessionImpl.java:754)
	at org.hibernate.internal.SessionImpl.persist(SessionImpl.java:738)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:364)
	at jdk.proxy2/jdk.proxy2.$Proxy136.persist(Unknown Source)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:319)
	at jdk.proxy2/jdk.proxy2.$Proxy136.persist(Unknown Source)
	at org.springframework.data.jpa.repository.support.SimpleJpaRepository.save(SimpleJpaRepository.java:618)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:351)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker$RepositoryFragmentMethodInvoker.lambda$new$0(RepositoryMethodInvoker.java:277)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.RepositoryComposition$RepositoryFragments.invoke(RepositoryComposition.java:516)
	at org.springframework.data.repository.core.support.RepositoryComposition.invoke(RepositoryComposition.java:285)
	at org.springframework.data.repository.core.support.RepositoryFactorySupport$ImplementationMethodExecutionInterceptor.invoke(RepositoryFactorySupport.java:628)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:168)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:392)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	... 74 common frames omitted
Caused by: com.mysql.cj.jdbc.exceptions.MysqlDataTruncation: Data truncation: Data too long for column 'source_tables' at row 1
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:104)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeInternal(ClientPreparedStatement.java:916)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1061)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdateInternal(ClientPreparedStatement.java:1009)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeLargeUpdate(ClientPreparedStatement.java:1320)
	at com.mysql.cj.jdbc.ClientPreparedStatement.executeUpdate(ClientPreparedStatement.java:994)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:194)
	... 124 common frames omitted
2025-12-11 14:34:17.622 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Closing JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:34:17.630 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown initiated...
2025-12-11 14:34:17.643 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Shutdown completed.
2025-12-11 14:34:22.727 INFO  c.x.s.SqlWorkflowApplication - Starting SqlWorkflowApplication using Java 21.0.6 with PID 81308 (/Users/xiaojunxiao/codes/xiaoxj/sql-workflow/target/classes started by xiaojunxiao in /Users/xiaojunxiao/codes/xiaoxj/sql-workflow)
2025-12-11 14:34:22.728 INFO  c.x.s.SqlWorkflowApplication - No active profile set, falling back to 1 default profile: "default"
2025-12-11 14:34:23.074 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2025-12-11 14:34:23.097 INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 20 ms. Found 4 JPA repository interfaces.
2025-12-11 14:34:23.431 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 9000 (http)
2025-12-11 14:34:23.435 INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-12-11 14:34:23.435 INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.19]
2025-12-11 14:34:23.453 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring embedded WebApplicationContext
2025-12-11 14:34:23.453 INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 709 ms
2025-12-11 14:34:23.591 INFO  o.h.jpa.internal.util.LogHelper - HHH000204: Processing PersistenceUnitInfo [name: default]
2025-12-11 14:34:23.619 INFO  org.hibernate.Version - HHH000412: Hibernate ORM core version 6.4.4.Final
2025-12-11 14:34:23.631 INFO  o.h.c.i.RegionFactoryInitiator - HHH000026: Second-level cache disabled
2025-12-11 14:34:23.704 INFO  o.s.o.j.p.SpringPersistenceUnitInfo - No LoadTimeWeaver setup: ignoring JPA class transformer
2025-12-11 14:34:23.714 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Starting...
2025-12-11 14:34:23.777 INFO  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4ef28dc4
2025-12-11 14:34:23.778 INFO  com.zaxxer.hikari.HikariDataSource - HikariPool-1 - Start completed.
2025-12-11 14:34:23.806 WARN  org.hibernate.orm.deprecation - HHH90000025: MySQLDialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2025-12-11 14:34:24.105 INFO  o.h.e.t.j.p.i.JtaPlatformInitiator - HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2025-12-11 14:34:24.143 INFO  o.s.o.j.LocalContainerEntityManagerFactoryBean - Initialized JPA EntityManagerFactory for persistence unit 'default'
2025-12-11 14:34:24.501 WARN  o.s.b.a.o.j.JpaBaseConfiguration$JpaWebConfiguration - spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2025-12-11 14:34:25.033 INFO  o.s.b.a.e.web.EndpointLinksResolver - Exposing 3 endpoint(s) beneath base path '/actuator'
2025-12-11 14:34:25.068 INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 9000 (http) with context path ''
2025-12-11 14:34:25.075 INFO  c.x.s.SqlWorkflowApplication - Started SqlWorkflowApplication in 2.526 seconds (process running for 2.788)
2025-12-11 14:34:25.406 INFO  o.a.c.c.C.[Tomcat].[localhost].[/] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-12-11 14:34:25.406 INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-12-11 14:34:25.407 INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-12-11 14:34:31.107 INFO  c.x.s.d.workflow.WorkflowOperator - create workflow definition, url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition, param:{"name":"dim_gzg_pub_ip_location_info","locations":[{"taskCode":159748578432608,"x":100,"y":100}],"taskDefinitionJson":[{"code":159748578432608,"version":0,"name":"SHELL1765434871102","description":"","taskType":"SHELL","taskParams":{"dependence":{},"conditionResult":null,"waitStartTimeout":{},"switchResult":{},"resourceList":[],"localParams":[],"rawScript":"--昨日全部ip\nwith all_ip as (\nselect\n    sip as ip\nfrom\n    (select ip as sip\n    from ods.ods_db_user_t_account_resigter_info_0db\n    where ip <> ''\n    and ip rlike '\\\\.'\n    and ip not rlike 'http'\n    and ip not rlike 'f29'\n    group by ip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pc_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_wmp_heartbeat_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_0log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_heartbeat_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_app_em_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_mb_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    union all\n    select sip\n    from ods.ods_pws_behavior_di_1log\n    where dt = date_sub(current_date(), 1)\n    and sip is not null\n    group by sip\n    )t\ngroup by \n    sip\n)\n\n--每日ip表临时表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info_temp\nselect\n    ip,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then province\n        else country\n    end as province,\n    case \n        when province in ('北京市','上海市','天津市','重庆市','香港','澳门','西藏自治区','内蒙古自治区',\n                '广西壮族自治区','宁夏回族自治区','新疆维吾尔自治区','湖北省','广东省','河南省','山东省','河北省',\n                '浙江省','辽宁省','四川省','安徽省','湖南省','陕西省','吉林省','福建省','山西省','云南省','江西省','贵州省',\n                '甘肃省','青海省','黑龙江省','江苏省','海南省','台湾省') then city\n        else null\n    end as city,\n    date_sub(current_date,1) as dt\nfrom\n    (select\n        ip,\n        case \n            -- 4个直辖市\n            when province like '%北京%' then '北京市'\n            when province like '%上海%' then '上海市'\n            when province like '%天津%' then '天津市'\n            when province like '%重庆%' then '重庆市'\n            -- 2个特别行政区\n            when province like '%香港%' then '香港'\n            when province like '%澳门%' then '澳门'\n            -- 5个自治区\n            when province like '%西藏%' then '西藏自治区'\n            when province like '%内蒙古%' then '内蒙古自治区'\n            when province like '%广西%' then '广西壮族自治区'\n            when province like '%宁夏%' then '宁夏回族自治区'\n            when province like '%新疆%' then '新疆维吾尔自治区'\n            -- 23个省\n            when province like '%湖北%' then '湖北省'\n            when province like '%广东%' then '广东省'\n            when province like '%河南%' then '河南省'\n            when province like '%山东%' then '山东省'\n            when province like '%河北%' then '河北省'\n            when province like '%浙江%' then '浙江省'\n            when province like '%辽宁%' then '辽宁省'\n            when province like '%四川%' then '四川省'\n            when province like '%安徽%' then '安徽省'\n            when province like '%湖南%' then '湖南省'\n            when province like '%陕西%' then '陕西省'\n            when province like '%吉林%' then '吉林省'\n            when province like '%福建%' then '福建省'\n            when province like '%山西%' then '山西省'\n            when province like '%云南%' then '云南省'\n            when province like '%江西%' then '江西省'\n            when province like '%贵州%' then '贵州省'\n            when province like '%甘肃%' then '甘肃省'\n            when province like '%青海%' then '青海省'\n            when province like '%黑龙江%' then '黑龙江省'\n            when province like '%江苏%' then '江苏省'\n            when province like '%海南%' then '海南省'\n            when province like '%台湾%' then '台湾省'\n        else province\n        end as province,\n        case \n            -- 一些需要特殊处理的市\n            when city like '%北京%'    then null\n            when city like '%上海%'    then null\n            when city like '%天津%'    then null\n            when city like '%重庆%'    then null\n            when city like '%香港%'    then null\n            when city like '%澳门%'    then null\n            when city like '%那曲%'    then '那曲市'\n            when city like '%山南%'    then '山南市'\n            when city like '%林芝%'    then '林芝市'\n            when city like '%日喀则%'  then '日喀则市'\n            when city like '%阿里地区%' then '阿里市'\n            when city like '%昌都%'     then '昌都市'\n            when city like '%桂林%'     then '桂林市'\n            when city like '%哈密%'     then '哈密市'\n            when city like '%阿勒泰%'   then '阿勒泰市'\n            when city like '%塔城%'    then '塔城市'\n            when city like '%喀什%'   then '喀什市'\n            when city like '%阿克苏%'  then '阿克苏市'\n            when city like '%和田%'   then '和田市'\n            when city like '%吐鲁番%'  then '吐鲁番市'\n            when city like '%恩施%'   then '恩施市'\n            when city like '%襄阳%'  then '襄阳市'\n            when city like '%汕头%'  then '汕头市'\n            when city like '%济源%'  then '济源市'\n            when city like '%郑州%'  then '郑州市'\n            when city like '%廊坊%'  then '廊坊市'\n            when city like '%朝阳%'  then '朝阳市'\n            when city like '%盘锦%'  then '盘锦市'\n            when city like '%本溪%'  then '本溪市'\n            when city like '%大连%'  then '大连市'\n            when city like '%沈阳%'  then '沈阳市'\n            when city like '%阿坝%'  then '阿坝州'\n            when city like '%蚌埠%'  then '蚌埠市'\n            when city like '%延边%'  then '延边市'\n            when city like '%临汾%'  then '临汾市'\n            when city like '%毕节%'  then '毕节市'\n            when city like '%铜仁%'  then '铜仁市'\n            when city like '%临夏%'  then '临夏市'\n            when city like '%海东%'  then '海东市'\n            when city like '%西宁%'  then '西宁市'\n            when city like '%大兴安岭%'  then '大兴安岭市'\n            when city like '%淮安%'  then '淮安市'\n            when city like '%苏州%'  then '苏州市'\n            when city like '%儋州%'  then '儋州市'\n            when city like '%新北%'  then '新北市'\n            when city like '%台中%'  then '台中市'\n            when city like '%高雄%'  then '高雄市'\n            when city like '%台南%'  then '台南市'\n            when city like '%桃园%'  then '桃园市'\n            when city like '%台北%'  then '台北市'\n            when city like '%南阳%'  then '南阳市'\n            when city = '0' then null\n        else city\n        end as city,\n        country\n    from\n        (select \n            ip,\n            get_json_object(default.get_address(ip), '$.country') as country,\n            get_json_object(default.get_address(ip), '$.province') as province,\n            get_json_object(default.get_address(ip), '$.city') as city\n        from \n            all_ip \n        )t1\n    )t2\nwhere \n    province != '0' and province is not null\n;\n\n--合并全量表\ninsert overwrite table cdm.dim_gzg_pub_ip_location_info\nselect\n    ip,\n    province,\n    city,\n    dt\nfrom \n    cdm.dim_gzg_pub_ip_location_info_temp\nunion all\nselect\n    t1.ip,\n    t1.province,\n    t1.city,\n    cast(date_sub(current_date,1) as string) as dt\nfrom\n    cdm.dim_gzg_pub_ip_location_info t1\nleft join\n    cdm.dim_gzg_pub_ip_location_info_temp t2\non \n    (t1.ip = t2.ip)\nwhere \n    t2.ip is null\n;","taskType":"SHELL"},"flag":"YES","taskPriority":"MEDIUM","workerGroup":"default","failRetryTimes":"3","failRetryInterval":"1","timeoutFlag":"CLOSE","timeoutNotifyStrategy":"WARN","timeout":0,"delayTime":"0","environmentCode":-1,"taskExecuteType":null,"cpuQuota":-1,"memoryMax":-1,"isCache":"NO"}],"taskRelationJson":[{"name":"","preTaskCode":0,"preTaskVersion":0,"postTaskCode":159748578432608,"postTaskVersion":0,"conditionType":0,"conditionParams":null}],"tenantCode":"admin","description":"昨日全部ip","executionType":"PARALLEL","globalParams":null,"timeout":"0"}
2025-12-11 14:34:31.164 INFO  c.x.s.d.workflow.WorkflowOperator - release workflow definition,url:https://ds.gp51.com/dolphinscheduler/projects/159198460609120/workflow-definition/159748578508384/release, param:WorkflowReleaseParam(name=null, releaseState=ONLINE)
2025-12-11 15:34:13.678 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=3m19s246ms).
2025-12-11 15:42:18.185 WARN  com.zaxxer.hikari.pool.HikariPool - HikariPool-1 - Thread starvation or clock leap detected (housekeeper delta=6m54s343ms).
